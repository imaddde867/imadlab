import{a$ as H,r,j as e,b1 as q,be as G,aF as W,bf as J,bh as K,bi as Q,bj as X,bk as Y,bl as Z}from"./vendor-BWaHT4c5.js";import{u as ee,s as v,B as R}from"./index-C2wzmnot.js";import{P as se}from"./page-header-B__z29Lg.js";import{C as c,d as o,a as d,b as m,c as x}from"./card-F9rnObCZ.js";import{C as te}from"./LoadingStates-Bc7aBWMd.js";const h="rounded-2xl border border-white/10 bg-white/[0.06] shadow-sm",p="px-6 pt-6 pb-0",u="text-lg font-semibold text-white",j="text-sm text-white/70",g="px-6 pb-6",ae="bg-white text-black border border-white/80 shadow-sm",ie="bg-black/40 text-white/75 hover:bg-white/10 hover:text-white",me=()=>{const y=H(),{toast:S}=ee(),[f,_]=r.useState(!0),[n,V]=r.useState([]),[ne,M]=r.useState([]),[N,I]=r.useState("7d"),b=r.useCallback(async()=>{_(!0);const t=new Date,a={"24h":new Date(t.getTime()-24*60*60*1e3),"7d":new Date(t.getTime()-7*24*60*60*1e3),"30d":new Date(t.getTime()-30*24*60*60*1e3)}[N].toISOString(),[i,l]=await Promise.all([v.from("page_views").select("*").gte("viewed_at",a).order("viewed_at",{ascending:!1}),v.from("visitor_sessions").select("*").gte("created_at",a).order("created_at",{ascending:!1})]);i.data&&V(i.data),l.data&&M(l.data),_(!1)},[N]);r.useEffect(()=>{(async()=>{const{data:{session:s}}=await v.auth.getSession();if(!s){y("/admin/login"),S({title:"Unauthorized",description:"Please log in to access this page.",variant:"destructive"});return}b()})()},[y,S,b]),r.useEffect(()=>{f||b()},[N]);const w=n.length,P=new Set(n.map(t=>t.session_id)).size,F=r.useMemo(()=>{const t=n.filter(s=>s.duration);return t.length?t.reduce((s,a)=>s+(a.duration||0),0)/t.length:0},[n]),U=r.useMemo(()=>{const t=n.reduce((i,l)=>(l.session_id&&(i[l.session_id]=(i[l.session_id]||0)+1),i),{}),s=Object.keys(t).length,a=Object.values(t).filter(i=>i===1).length;return s>0?a/s*100:0},[n]),C=r.useMemo(()=>{const t=n.reduce((s,a)=>{const i=a.traffic_source||"unknown";return s[i]=(s[i]||0)+1,s},{});return Object.entries(t).map(([s,a])=>({source:s,count:a})).sort((s,a)=>a.count-s.count)},[n]),T=r.useMemo(()=>{const t=n.reduce((s,a)=>{const i=a.device_type||"unknown";return s[i]=(s[i]||0)+1,s},{});return Object.entries(t).map(([s,a])=>({device:s,count:a})).sort((s,a)=>a.count-s.count)},[n]),L=r.useMemo(()=>{const t=n.reduce((s,a)=>{const i=a.browser||"unknown";return s[i]=(s[i]||0)+1,s},{});return Object.entries(t).map(([s,a])=>({browser:s,count:a})).sort((s,a)=>a.count-s.count)},[n]),k=r.useMemo(()=>{const t=n.reduce((s,a)=>{const i=a.os||"unknown";return s[i]=(s[i]||0)+1,s},{});return Object.entries(t).map(([s,a])=>({os:s,count:a})).sort((s,a)=>a.count-s.count)},[n]),$=r.useMemo(()=>{const t=n.reduce((s,a)=>{const i=a.country||"unknown";return s[i]=(s[i]||0)+1,s},{});return Object.entries(t).map(([s,a])=>({country:s,count:a})).sort((s,a)=>a.count-s.count)},[n]),D=r.useMemo(()=>{const t=n.filter(s=>s.referrer&&s.referrer!=="").reduce((s,a)=>{try{const l=new URL(a.referrer).hostname.replace(/^www\./,"");s[l]=(s[l]||0)+1}catch{s.unknown=(s.unknown||0)+1}return s},{});return Object.entries(t).map(([s,a])=>({referrer:s,count:a})).sort((s,a)=>a.count-s.count).slice(0,10)},[n]),O=r.useMemo(()=>{const t=n.filter(s=>s.utm_campaign).reduce((s,a)=>{const i=a.utm_campaign;return s[i]||(s[i]={views:0,sessions:new Set}),s[i].views++,a.session_id&&s[i].sessions.add(a.session_id),s},{});return Object.entries(t).map(([s,a])=>({campaign:s,views:a.views,visitors:a.sessions.size})).sort((s,a)=>a.views-s.views)},[n]),A=r.useMemo(()=>Object.entries(n.reduce((t,s)=>(t[s.path]||(t[s.path]={views:0,sessions:new Set,durations:[]}),t[s.path].views++,s.session_id&&t[s.path].sessions.add(s.session_id),s.duration&&t[s.path].durations.push(s.duration),t),{})).map(([t,s])=>({path:t,views:s.views,uniqueVisitors:s.sessions.size,avgDuration:s.durations.length?s.durations.reduce((a,i)=>a+i,0)/s.durations.length:0})).sort((t,s)=>s.views-t.views),[n]),E=t=>{const s=Math.floor(t/60),a=Math.floor(t%60);return s>0?`${s}m ${a}s`:`${a}s`},z=[{label:"Total Views",value:w.toLocaleString(),icon:e.jsx(q,{className:"h-5 w-5 text-white/60"})},{label:"Unique Visitors",value:P.toLocaleString(),icon:e.jsx(G,{className:"h-5 w-5 text-white/60"})},{label:"Avg. Duration",value:E(F),icon:e.jsx(W,{className:"h-5 w-5 text-white/60"})},{label:"Bounce Rate",value:`${U.toFixed(1)}%`,icon:e.jsx(J,{className:"h-5 w-5 text-white/60"})}],B=[{label:"Time Range",value:N==="24h"?"Last 24 Hours":N==="7d"?"Last 7 Days":"Last 30 Days"},{label:"Page Views",value:w.toLocaleString()}];return e.jsx("div",{className:"min-h-screen bg-black text-white py-12",children:e.jsxs("div",{className:"container-site space-y-10 pb-24",children:[e.jsx(se,{eyebrow:"Admin Suite",title:"Analytics Dashboard",description:"Track visitor engagement, traffic patterns, and site performance metrics.",breadcrumbs:[{label:"Admin",href:"/admin"},{label:"Analytics",href:"/admin/analytics"}],meta:B,actions:e.jsxs(R,{variant:"soft",onClick:b,disabled:f,children:[e.jsx(K,{className:`mr-2 h-4 w-4 ${f?"animate-spin":""}`}),"Refresh"]}),children:e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:z.map(t=>e.jsx(c,{className:"rounded-2xl border border-white/10 bg-white/5 shadow-[0_16px_48px_rgba(15,23,42,0.35)] backdrop-blur-sm",children:e.jsx(o,{className:"p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-xl bg-white/10",children:t.icon}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-[0.25em] text-white/60",children:t.label}),e.jsx("p",{className:"text-2xl font-bold text-white",children:t.value})]})]})})},t.label))})}),e.jsx("div",{className:"flex gap-2",children:["24h","7d","30d"].map(t=>e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>I(t),className:`rounded-xl px-4 py-2 text-sm font-semibold transition ${N===t?ae:ie}`,children:t==="24h"?"24 Hours":t==="7d"?"7 Days":"30 Days"},t))}),f?e.jsx(te,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(c,{className:h,children:[e.jsxs(d,{className:`${p} space-y-1`,children:[e.jsx(m,{className:u,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),"Traffic Sources"]})}),e.jsx(x,{className:j,children:"Where your visitors are coming from"})]}),e.jsx(o,{className:`${g} pt-4`,children:C.length===0?e.jsx("p",{className:"text-white/60 text-center py-8",children:"No data available"}):e.jsx("div",{className:"space-y-3",children:C.map(({source:t,count:s})=>{const a=(s/w*100).toFixed(1);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-white/90 capitalize min-w-20",children:t}),e.jsx("div",{className:"flex-1 h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full transition-all",style:{width:`${a}%`}})})]}),e.jsxs("div",{className:"flex items-center gap-3 ml-4",children:[e.jsxs("span",{className:"text-sm text-white/70 min-w-12 text-right",children:[a,"%"]}),e.jsx("span",{className:"text-sm font-semibold text-white min-w-12 text-right",children:s.toLocaleString()})]})]},t)})})})]}),e.jsxs(c,{className:h,children:[e.jsxs(d,{className:`${p} space-y-1`,children:[e.jsx(m,{className:u,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),"Devices"]})}),e.jsx(x,{className:j,children:"Device type breakdown"})]}),e.jsx(o,{className:`${g} pt-4`,children:T.length===0?e.jsx("p",{className:"text-white/60 text-center py-8",children:"No data available"}):e.jsx("div",{className:"space-y-3",children:T.map(({device:t,count:s})=>{const a=(s/w*100).toFixed(1);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-white/90 capitalize min-w-20",children:t}),e.jsx("div",{className:"flex-1 h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full transition-all",style:{width:`${a}%`}})})]}),e.jsxs("div",{className:"flex items-center gap-3 ml-4",children:[e.jsxs("span",{className:"text-sm text-white/70 min-w-12 text-right",children:[a,"%"]}),e.jsx("span",{className:"text-sm font-semibold text-white min-w-12 text-right",children:s.toLocaleString()})]})]},t)})})})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(c,{className:h,children:[e.jsxs(d,{className:`${p} space-y-1`,children:[e.jsx(m,{className:u,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Browsers"]})}),e.jsx(x,{className:j,children:"Browser distribution"})]}),e.jsx(o,{className:`${g} pt-4`,children:L.length===0?e.jsx("p",{className:"text-white/60 text-center py-8",children:"No data available"}):e.jsx("div",{className:"space-y-3",children:L.slice(0,5).map(({browser:t,count:s})=>{const a=(s/w*100).toFixed(1);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-white/90 min-w-20",children:t}),e.jsx("div",{className:"flex-1 h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-emerald-500 rounded-full transition-all",style:{width:`${a}%`}})})]}),e.jsxs("div",{className:"flex items-center gap-3 ml-4",children:[e.jsxs("span",{className:"text-sm text-white/70 min-w-12 text-right",children:[a,"%"]}),e.jsx("span",{className:"text-sm font-semibold text-white min-w-12 text-right",children:s.toLocaleString()})]})]},t)})})})]}),e.jsxs(c,{className:h,children:[e.jsxs(d,{className:`${p} space-y-1`,children:[e.jsx(m,{className:u,children:"Operating Systems"}),e.jsx(x,{className:j,children:"OS distribution"})]}),e.jsx(o,{className:`${g} pt-4`,children:k.length===0?e.jsx("p",{className:"text-white/60 text-center py-8",children:"No data available"}):e.jsx("div",{className:"space-y-3",children:k.slice(0,5).map(({os:t,count:s})=>{const a=(s/w*100).toFixed(1);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-white/90 min-w-20",children:t}),e.jsx("div",{className:"flex-1 h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-orange-500 to-red-500 rounded-full transition-all",style:{width:`${a}%`}})})]}),e.jsxs("div",{className:"flex items-center gap-3 ml-4",children:[e.jsxs("span",{className:"text-sm text-white/70 min-w-12 text-right",children:[a,"%"]}),e.jsx("span",{className:"text-sm font-semibold text-white min-w-12 text-right",children:s.toLocaleString()})]})]},t)})})})]})]}),$.filter(t=>t.country!=="unknown").length>0&&e.jsxs(c,{className:h,children:[e.jsxs(d,{className:`${p} space-y-1`,children:[e.jsx(m,{className:u,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"Geographic Distribution"]})}),e.jsx(x,{className:j,children:"Visitors by country"})]}),e.jsx(o,{className:`${g} pt-4`,children:e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:$.filter(t=>t.country!=="unknown").slice(0,10).map(({country:t,count:s})=>{const a=(s/w*100).toFixed(1);return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-white/5",children:[e.jsx("span",{className:"text-sm font-medium text-white/90",children:t}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm text-white/70",children:[a,"%"]}),e.jsx("span",{className:"text-sm font-semibold text-white min-w-12 text-right",children:s.toLocaleString()})]})]},t)})})})]}),D.length>0&&e.jsxs(c,{className:h,children:[e.jsxs(d,{className:`${p} space-y-1`,children:[e.jsx(m,{className:u,children:"Top Referrers"}),e.jsx(x,{className:j,children:"External sites sending traffic"})]}),e.jsx(o,{className:`${g} pt-4`,children:e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:D.map(({referrer:t,count:s})=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-white/5",children:[e.jsx("span",{className:"text-sm font-mono text-white/90 truncate max-w-[200px]",children:t}),e.jsx("span",{className:"text-sm font-semibold text-white",children:s.toLocaleString()})]},t))})})]}),O.length>0&&e.jsxs(c,{className:h,children:[e.jsxs(d,{className:`${p} space-y-1`,children:[e.jsx(m,{className:u,children:"Campaign Performance"}),e.jsx(x,{className:j,children:"UTM campaign tracking"})]}),e.jsx(o,{className:`${g} pt-4`,children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-xs uppercase tracking-widest text-white/70 border-b border-white/10",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold",children:"Campaign"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:"Views"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:"Visitors"})]})}),e.jsx("tbody",{children:O.map(({campaign:t,views:s,visitors:a})=>e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5 transition",children:[e.jsx("td",{className:"py-3 px-4 text-sm text-white/90",children:t}),e.jsx("td",{className:"py-3 px-4 text-right text-white/90",children:s.toLocaleString()}),e.jsx("td",{className:"py-3 px-4 text-right text-white/90",children:a.toLocaleString()})]},t))})]})})})]}),e.jsxs(c,{className:h,children:[e.jsxs(d,{className:`${p} space-y-1`,children:[e.jsx(m,{className:u,children:"Top Pages"}),e.jsx(x,{className:j,children:"Most visited pages with engagement metrics"})]}),e.jsx(o,{className:`${g} pt-4`,children:A.length===0?e.jsx("p",{className:"text-white/60 text-center py-8",children:"No page views recorded yet"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-xs uppercase tracking-widest text-white/70 border-b border-white/10",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold",children:"Page"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:"Views"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:"Visitors"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:"Avg. Duration"})]})}),e.jsx("tbody",{children:A.map(t=>e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5 transition",children:[e.jsx("td",{className:"py-3 px-4 font-mono text-sm text-white/90",children:t.path}),e.jsx("td",{className:"py-3 px-4 text-right text-white/90",children:t.views.toLocaleString()}),e.jsx("td",{className:"py-3 px-4 text-right text-white/90",children:t.uniqueVisitors.toLocaleString()}),e.jsx("td",{className:"py-3 px-4 text-right text-white/70",children:E(t.avgDuration)})]},t.path))})]})})})]})]})]})})};export{me as default};
