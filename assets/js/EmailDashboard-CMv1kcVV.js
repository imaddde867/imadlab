import{c as _s,r as n,j as e,o as Ss,q as St,v as Y,w as z,x as yt,y as Xe,z as ys,A as Ct,C as Cs,D as be,E as Es,e as Ts,a as ks,s as I,F as Rs,B as P,H as ue,I as me,J as he,K as pe,M as xe,N as fe}from"./index-B1IGmRtD.js";import{C as je,d as Ne,a as $e,b as Be,c as ze}from"./card-Cw1i-YhQ.js";import{E as _e,P as Is}from"./page-header-Bv2ymM8H.js";import{T as ae,a as Ps}from"./tag-BD69WoyC.js";import{I as Ms}from"./input-DGhUk4PP.js";import{f as As,g as Fs}from"./content-selects-Bl1-GPQZ.js";import{U as vt,T as Ds,R as Ls}from"./users-CPJGNV5F.js";import{M as Os}from"./mail-jmgBwFpB.js";import{C as qs}from"./copy-DLv6lLks.js";const Se=_s("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);function $s(s,i=[]){let c=[];function l(N,d){const x=n.createContext(d),f=c.length;c=[...c,d];function g(h){const{scope:w,children:M,..._}=h,k=w?.[s][f]||x,F=n.useMemo(()=>_,Object.values(_));return e.jsx(k.Provider,{value:F,children:M})}function b(h,w){const M=w?.[s][f]||x,_=n.useContext(M);if(_)return _;if(d!==void 0)return d;throw new Error(`\`${h}\` must be used within \`${N}\``)}return g.displayName=N+"Provider",[g,b]}const m=()=>{const N=c.map(d=>n.createContext(d));return function(x){const f=x?.[s]||N;return n.useMemo(()=>({[`__scope${s}`]:{...x,[s]:f}}),[x,f])}};return m.scopeName=s,[l,Bs(m,...i)]}function Bs(...s){const i=s[0];if(s.length===1)return i;const c=()=>{const l=s.map(m=>({useScope:m(),scopeName:m.scopeName}));return function(N){const d=l.reduce((x,{useScope:f,scopeName:g})=>{const h=f(N)[`__scope${g}`];return{...x,...h}},{});return n.useMemo(()=>({[`__scope${i.scopeName}`]:d}),[d])}};return c.scopeName=i.scopeName,c}var zs=n.createContext(void 0);function Et(s){const i=n.useContext(zs);return s||i||"ltr"}var Ue="rovingFocusGroup.onEntryFocus",Us={bubbles:!1,cancelable:!0},Ee="RovingFocusGroup",[Je,Tt,Qs]=Ss(Ee),[Gs,kt]=$s(Ee,[Qs]),[Hs,Ks]=Gs(Ee),Rt=n.forwardRef((s,i)=>e.jsx(Je.Provider,{scope:s.__scopeRovingFocusGroup,children:e.jsx(Je.Slot,{scope:s.__scopeRovingFocusGroup,children:e.jsx(Vs,{...s,ref:i})})}));Rt.displayName=Ee;var Vs=n.forwardRef((s,i)=>{const{__scopeRovingFocusGroup:c,orientation:l,loop:m=!1,dir:N,currentTabStopId:d,defaultCurrentTabStopId:x,onCurrentTabStopIdChange:f,onEntryFocus:g,preventScrollOnEntryFocus:b=!1,...h}=s,w=n.useRef(null),M=yt(i,w),_=Et(N),[k=null,F]=Xe({prop:d,defaultProp:x,onChange:f}),[C,S]=n.useState(!1),$=ys(g),ie=Tt(c),ne=n.useRef(!1),[W,ve]=n.useState(0);return n.useEffect(()=>{const R=w.current;if(R)return R.addEventListener(Ue,$),()=>R.removeEventListener(Ue,$)},[$]),e.jsx(Hs,{scope:c,orientation:l,dir:_,loop:m,currentTabStopId:k,onItemFocus:n.useCallback(R=>F(R),[F]),onItemShiftTab:n.useCallback(()=>S(!0),[]),onFocusableItemAdd:n.useCallback(()=>ve(R=>R+1),[]),onFocusableItemRemove:n.useCallback(()=>ve(R=>R-1),[]),children:e.jsx(Y.div,{tabIndex:C||W===0?-1:0,"data-orientation":l,...h,ref:M,style:{outline:"none",...s.style},onMouseDown:z(s.onMouseDown,()=>{ne.current=!0}),onFocus:z(s.onFocus,R=>{const Te=!ne.current;if(R.target===R.currentTarget&&Te&&!C){const re=new CustomEvent(Ue,Us);if(R.currentTarget.dispatchEvent(re),!re.defaultPrevented){const G=ie().filter(U=>U.focusable),ke=G.find(U=>U.active),Re=G.find(U=>U.id===k),Ie=[ke,Re,...G].filter(Boolean).map(U=>U.ref.current);Mt(Ie,b)}}ne.current=!1}),onBlur:z(s.onBlur,()=>S(!1))})})}),It="RovingFocusGroupItem",Pt=n.forwardRef((s,i)=>{const{__scopeRovingFocusGroup:c,focusable:l=!0,active:m=!1,tabStopId:N,...d}=s,x=St(),f=N||x,g=Ks(It,c),b=g.currentTabStopId===f,h=Tt(c),{onFocusableItemAdd:w,onFocusableItemRemove:M}=g;return n.useEffect(()=>{if(l)return w(),()=>M()},[l,w,M]),e.jsx(Je.ItemSlot,{scope:c,id:f,focusable:l,active:m,children:e.jsx(Y.span,{tabIndex:b?0:-1,"data-orientation":g.orientation,...d,ref:i,onMouseDown:z(s.onMouseDown,_=>{l?g.onItemFocus(f):_.preventDefault()}),onFocus:z(s.onFocus,()=>g.onItemFocus(f)),onKeyDown:z(s.onKeyDown,_=>{if(_.key==="Tab"&&_.shiftKey){g.onItemShiftTab();return}if(_.target!==_.currentTarget)return;const k=Ws(_,g.orientation,g.dir);if(k!==void 0){if(_.metaKey||_.ctrlKey||_.altKey||_.shiftKey)return;_.preventDefault();let C=h().filter(S=>S.focusable).map(S=>S.ref.current);if(k==="last")C.reverse();else if(k==="prev"||k==="next"){k==="prev"&&C.reverse();const S=C.indexOf(_.currentTarget);C=g.loop?Xs(C,S+1):C.slice(S+1)}setTimeout(()=>Mt(C))}})})})});Pt.displayName=It;var Ys={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Js(s,i){return i!=="rtl"?s:s==="ArrowLeft"?"ArrowRight":s==="ArrowRight"?"ArrowLeft":s}function Ws(s,i,c){const l=Js(s.key,c);if(!(i==="vertical"&&["ArrowLeft","ArrowRight"].includes(l))&&!(i==="horizontal"&&["ArrowUp","ArrowDown"].includes(l)))return Ys[l]}function Mt(s,i=!1){const c=document.activeElement;for(const l of s)if(l===c||(l.focus({preventScroll:i}),document.activeElement!==c))return}function Xs(s,i){return s.map((c,l)=>s[(i+l)%s.length])}var Zs=Rt,ea=Pt,Ze="Tabs",[ta]=Ct(Ze,[kt]),At=kt(),[sa,et]=ta(Ze),Ft=n.forwardRef((s,i)=>{const{__scopeTabs:c,value:l,onValueChange:m,defaultValue:N,orientation:d="horizontal",dir:x,activationMode:f="automatic",...g}=s,b=Et(x),[h,w]=Xe({prop:l,onChange:m,defaultProp:N});return e.jsx(sa,{scope:c,baseId:St(),value:h,onValueChange:w,orientation:d,dir:b,activationMode:f,children:e.jsx(Y.div,{dir:b,"data-orientation":d,...g,ref:i})})});Ft.displayName=Ze;var Dt="TabsList",Lt=n.forwardRef((s,i)=>{const{__scopeTabs:c,loop:l=!0,...m}=s,N=et(Dt,c),d=At(c);return e.jsx(Zs,{asChild:!0,...d,orientation:N.orientation,dir:N.dir,loop:l,children:e.jsx(Y.div,{role:"tablist","aria-orientation":N.orientation,...m,ref:i})})});Lt.displayName=Dt;var Ot="TabsTrigger",qt=n.forwardRef((s,i)=>{const{__scopeTabs:c,value:l,disabled:m=!1,...N}=s,d=et(Ot,c),x=At(c),f=zt(d.baseId,l),g=Ut(d.baseId,l),b=l===d.value;return e.jsx(ea,{asChild:!0,...x,focusable:!m,active:b,children:e.jsx(Y.button,{type:"button",role:"tab","aria-selected":b,"aria-controls":g,"data-state":b?"active":"inactive","data-disabled":m?"":void 0,disabled:m,id:f,...N,ref:i,onMouseDown:z(s.onMouseDown,h=>{!m&&h.button===0&&h.ctrlKey===!1?d.onValueChange(l):h.preventDefault()}),onKeyDown:z(s.onKeyDown,h=>{[" ","Enter"].includes(h.key)&&d.onValueChange(l)}),onFocus:z(s.onFocus,()=>{const h=d.activationMode!=="manual";!b&&!m&&h&&d.onValueChange(l)})})})});qt.displayName=Ot;var $t="TabsContent",Bt=n.forwardRef((s,i)=>{const{__scopeTabs:c,value:l,forceMount:m,children:N,...d}=s,x=et($t,c),f=zt(x.baseId,l),g=Ut(x.baseId,l),b=l===x.value,h=n.useRef(b);return n.useEffect(()=>{const w=requestAnimationFrame(()=>h.current=!1);return()=>cancelAnimationFrame(w)},[]),e.jsx(Cs,{present:m||b,children:({present:w})=>e.jsx(Y.div,{"data-state":b?"active":"inactive","data-orientation":x.orientation,role:"tabpanel","aria-labelledby":f,hidden:!w,id:g,tabIndex:0,...d,ref:i,style:{...s.style,animationDuration:h.current?"0s":void 0},children:w&&N})})});Bt.displayName=$t;function zt(s,i){return`${s}-trigger-${i}`}function Ut(s,i){return`${s}-content-${i}`}var aa=Ft,Qt=Lt,Gt=qt,Ht=Bt;const ia=aa,Kt=n.forwardRef(({className:s,...i},c)=>e.jsx(Qt,{ref:c,className:be("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...i}));Kt.displayName=Qt.displayName;const ye=n.forwardRef(({className:s,...i},c)=>e.jsx(Gt,{ref:c,className:be("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...i}));ye.displayName=Gt.displayName;const Ce=n.forwardRef(({className:s,...i},c)=>e.jsx(Ht,{ref:c,className:be("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...i}));Ce.displayName=Ht.displayName;function na(s){const i=n.useRef({value:s,previous:s});return n.useMemo(()=>(i.current.value!==s&&(i.current.previous=i.current.value,i.current.value=s),i.current.previous),[s])}var tt="Switch",[ra]=Ct(tt),[ca,oa]=ra(tt),Vt=n.forwardRef((s,i)=>{const{__scopeSwitch:c,name:l,checked:m,defaultChecked:N,required:d,disabled:x,value:f="on",onCheckedChange:g,form:b,...h}=s,[w,M]=n.useState(null),_=yt(i,$=>M($)),k=n.useRef(!1),F=w?b||!!w.closest("form"):!0,[C=!1,S]=Xe({prop:m,defaultProp:N,onChange:g});return e.jsxs(ca,{scope:c,checked:C,disabled:x,children:[e.jsx(Y.button,{type:"button",role:"switch","aria-checked":C,"aria-required":d,"data-state":Wt(C),"data-disabled":x?"":void 0,disabled:x,value:f,...h,ref:_,onClick:z(s.onClick,$=>{S(ie=>!ie),F&&(k.current=$.isPropagationStopped(),k.current||$.stopPropagation())})}),F&&e.jsx(la,{control:w,bubbles:!k.current,name:l,value:f,checked:C,required:d,disabled:x,form:b,style:{transform:"translateX(-100%)"}})]})});Vt.displayName=tt;var Yt="SwitchThumb",Jt=n.forwardRef((s,i)=>{const{__scopeSwitch:c,...l}=s,m=oa(Yt,c);return e.jsx(Y.span,{"data-state":Wt(m.checked),"data-disabled":m.disabled?"":void 0,...l,ref:i})});Jt.displayName=Yt;var la=s=>{const{control:i,checked:c,bubbles:l=!0,...m}=s,N=n.useRef(null),d=na(c),x=Es(i);return n.useEffect(()=>{const f=N.current,g=window.HTMLInputElement.prototype,h=Object.getOwnPropertyDescriptor(g,"checked").set;if(d!==c&&h){const w=new Event("click",{bubbles:l});h.call(f,c),f.dispatchEvent(w)}},[d,c,l]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:c,...m,tabIndex:-1,ref:N,style:{...s.style,...x,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Wt(s){return s?"checked":"unchecked"}var Xt=Vt,da=Jt;const We=n.forwardRef(({className:s,...i},c)=>e.jsx(Xt,{className:be("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...i,ref:c,children:e.jsx(da,{className:be("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));We.displayName=Xt.displayName;const ua=s=>s==="project"?"project":"blog_post",ma=s=>{switch(s){case"processing":case"sent":case"failed":return s;case"pending":default:return"pending"}},gt="imadlab-email-auto-send-blog",wt="imadlab-email-auto-send-project",jt=(s,i=!1)=>{if(typeof window>"u")return i;try{const c=window.localStorage.getItem(s);return c===null?i:c==="true"}catch{return i}},Nt=s=>{const i=[s.clicked_at,s.opened_at,s.delivered_at,s.sent_at,s.bounced_at,s.unsubscribed_at,s.created_at].filter(Boolean).map(c=>new Date(c).getTime());return i.length?Math.max(...i):0},Zt=s=>s.unsubscribed_at?{label:"Unsubscribed",variant:"warning"}:s.bounced_at?{label:"Bounced",variant:"danger"}:s.clicked_at?{label:"Clicked",variant:"accent"}:s.opened_at?{label:"Opened",variant:"info"}:s.delivered_at?{label:"Delivered",variant:"success"}:s.sent_at?{label:"Sent",variant:"neutral"}:{label:"Queued",variant:"outline"},_t=s=>s.clicked_at??s.opened_at??s.delivered_at??s.sent_at??s.bounced_at??s.unsubscribed_at??s.created_at??null,ha=(s,i)=>s?Zt(s):i==="sent"?{label:"Not sent",variant:"warning"}:i==="failed"?{label:"Not sent",variant:"danger"}:i==="processing"?{label:"Processing",variant:"neutral"}:{label:"Queued",variant:"outline"},Qe="rounded-xl border border-white/10 bg-white/[0.03]",Ge="px-6 pt-6 pb-0",He="text-lg font-semibold text-white",Ke="text-sm text-white/70",Ve="px-6 pb-6 space-y-6",pa="bg-white text-black border border-white/80 shadow-sm",xa="bg-black/40 text-white/75 hover:bg-white/10 hover:text-white",Ye="text-xs uppercase tracking-widest text-white/70",ya=()=>{const s=Ts(),{toast:i}=ks(),[c,l]=n.useState(null),[m,N]=n.useState([]),[d,x]=n.useState(null),[f,g]=n.useState(!0),[b,h]=n.useState(!1),[w,M]=n.useState(""),[_,k]=n.useState(!1),[F,C]=n.useState(""),[S,$]=n.useState([]),[ie,ne]=n.useState({}),[W,ve]=n.useState("all"),[R,Te]=n.useState(""),[re,G]=n.useState(!1),[ke,Re]=n.useState({}),[st,Ie]=n.useState({}),[U,es]=n.useState({}),[ts,ge]=n.useState({}),[ss,Pe]=n.useState({}),[X,as]=n.useState(()=>jt(gt)),[Z,is]=n.useState(()=>jt(wt)),H=n.useCallback(async()=>{try{g(!0);const{data:t,error:a}=await I.from("email_queue").select("*").order("created_at",{ascending:!1}).limit(50);if(a)throw a;const r=(t??[]).map(v=>({...v,content_type:ua(v.content_type??null),status:ma(v.status??null)})),u=r.filter(v=>v.content_type==="blog_post").map(v=>v.content_id),p=r.filter(v=>v.content_type==="project").map(v=>v.content_id),[E,T]=await Promise.all([u.length>0?I.from("posts").select(As).in("id",u):Promise.resolve({data:[]}),p.length>0?I.from("projects").select(Fs).in("id",p):Promise.resolve({data:[]})]),y=new Map((E.data||[]).map(v=>[v.id,v.title])),D=new Map((T.data||[]).map(v=>[v.id,v.title])),ee=r.map(v=>({...v,content_title:v.content_type==="blog_post"?y.get(v.content_id):D.get(v.content_id)}));N(ee);const[{data:B},{data:K}]=await Promise.all([I.from("newsletter_subscribers").select("status, email, created_at, updated_at"),I.from("email_analytics").select("*")]);if(B&&K){const v=B,L=K,ce=v.length,Oe=v.filter(o=>!o.status||o.status==="active").length,j=L.filter(o=>o.sent_at).length,A=L.filter(o=>o.delivered_at).length,we=L.filter(o=>o.opened_at).length,qe=L.filter(o=>o.clicked_at).length,oe=v.map(o=>({email:o.email,status:o.status??"active",created_at:o.created_at??void 0,updated_at:o.updated_at??void 0})),te={},se={},le={},de={};L.forEach(o=>{const O=o.subscriber_email;te[O]||(te[O]={sent:0,delivered:0,opened:0,clicked:0,bounced:0,lastEvent:void 0});const V=te[O];de[O]||(de[O]=[]),de[O].push(o),o.sent_at&&(V.sent+=1),o.delivered_at&&(V.delivered+=1),o.opened_at&&(V.opened+=1),o.clicked_at&&(V.clicked+=1),o.bounced_at&&(V.bounced+=1);const bt=[o.clicked_at,o.opened_at,o.delivered_at,o.sent_at,o.bounced_at,o.unsubscribed_at].filter(Boolean).map(q=>new Date(q).getTime());if(bt.length){const q=Math.max(...bt);(!V.lastEvent||q>new Date(V.lastEvent).getTime())&&(V.lastEvent=new Date(q).toISOString())}if(o.email_queue_id){se[o.email_queue_id]||(se[o.email_queue_id]={metrics:{sent:0,delivered:0,opened:0,clicked:0,bounced:0,uniqueRecipients:0},recipients:new Set});const q=se[o.email_queue_id];q.recipients.add(o.subscriber_email),o.sent_at&&(q.metrics.sent+=1),o.delivered_at&&(q.metrics.delivered+=1),o.opened_at&&(q.metrics.opened+=1),o.clicked_at&&(q.metrics.clicked+=1),o.bounced_at&&(q.metrics.bounced+=1),le[o.email_queue_id]||(le[o.email_queue_id]=[]),le[o.email_queue_id].push(o)}});const ht={};Object.entries(se).forEach(([o,O])=>{ht[o]={...O.metrics,uniqueRecipients:O.recipients.size}});const pt=(o,O)=>Nt(O)-Nt(o);Object.values(le).forEach(o=>o.sort(pt)),Object.values(de).forEach(o=>o.sort(pt)),$(oe),ne(te),Re(ht),Ie(le),es(de);const xt=A>0?A:j,ft=A>0?A:j;x({totalSubscribers:ce,activeSubscribers:Oe,totalEmailsSent:j,deliveryRate:j>0?A/j*100:0,openRate:xt>0?we/xt*100:0,clickRate:ft>0?qe/ft*100:0})}}catch(t){console.error("Error loading email data:",t),i({title:"Error",description:"Failed to load email data",variant:"destructive"})}finally{g(!1)}},[i]);n.useEffect(()=>{(async()=>{const{data:r}=await I.auth.getUser();if(!r.user){s("/admin/login"),i({title:"Unauthorized",description:"Please log in to access the admin dashboard.",variant:"destructive"});return}l({email:r.user.email}),await H()})();const{data:a}=I.auth.onAuthStateChange((r,u)=>{u?.user?l({email:u.user.email}):s("/admin/login")});return()=>{a?.subscription.unsubscribe()}},[H,s,i]),n.useEffect(()=>{try{window.localStorage.setItem(gt,X?"true":"false")}catch{}},[X]),n.useEffect(()=>{try{window.localStorage.setItem(wt,Z?"true":"false")}catch{}},[Z]);const at=async(t,a)=>{try{h(!0);const r={};t&&t.length&&(r.queueIds=t),a&&a.length&&(r.recipientEmails=a);const{data:u,error:p}=await I.functions.invoke("send-newsletter-emails",{method:"POST",body:Object.keys(r).length?r:{}});if(p)throw p;i({title:"Success",description:`Processed ${u?.processedItems??0} email queue items`}),await H()}catch(r){console.error("Error processing email queue:",r),i({title:"Error",description:"Failed to process email queue",variant:"destructive"})}finally{h(!1)}},it=async(t,a)=>{await at([t],a)},ns=async t=>{if(confirm("Delete this queue entry? This cannot be undone."))try{h(!0);const{error:a}=await I.from("email_queue").delete().eq("id",t);if(a)throw a;i({title:"Queue item deleted",description:"The email entry has been removed."}),await H()}catch(a){console.error(`Error deleting queue item ${t}:`,a),i({title:"Error",description:"Failed to delete this queue item.",variant:"destructive"})}finally{h(!1)}},rs=async(t,a)=>{try{G(!0);const{error:r}=await I.from("newsletter_subscribers").update({status:a,updated_at:new Date().toISOString()}).eq("email",t);if(r)throw r;i({title:"Subscriber updated",description:`${t} set to ${a}.`}),await H()}catch(r){console.error("Error updating subscriber:",r),i({title:"Error",description:"Failed to update subscriber status.",variant:"destructive"})}finally{G(!1)}},cs=async t=>{if(confirm(`Remove ${t} from subscribers? This cannot be undone.`))try{G(!0);const{error:a}=await I.from("newsletter_subscribers").delete().eq("email",t);if(a)throw a;i({title:"Subscriber removed",description:`${t} has been deleted.`}),await H()}catch(a){console.error("Error deleting subscriber:",a),i({title:"Error",description:"Failed to delete subscriber.",variant:"destructive"})}finally{G(!1)}},nt=t=>Array.from(new Set(t.map(a=>a.trim().toLowerCase()).filter(Boolean))),rt=async(t,a,r)=>{const u={recipient_emails:a,scheduled_at:r??null},{error:p}=await I.from("email_queue").update(u).eq("id",t);if(!p)return{recipientStored:!0};if((p.message||"").toLowerCase().includes("recipient_emails")){const{error:T}=await I.from("email_queue").update({scheduled_at:r??null}).eq("id",t);if(T)throw T;return{recipientStored:!1}}throw p},ct=async(t,a,r)=>{const u={content_id:t.content_id,content_type:t.content_type,status:"pending",scheduled_at:r??null,recipient_emails:a},{data:p,error:E}=await I.from("email_queue").insert(u).select("id").single();if(!E)return p?.id;if((E.message||"").toLowerCase().includes("recipient_emails")){const{data:y,error:D}=await I.from("email_queue").insert({content_id:t.content_id,content_type:t.content_type,status:"pending",scheduled_at:r??null}).select("id").single();if(D)throw D;return y?.id}throw E},os=async(t,a)=>{const r=nt(a);if(!r.length){i({title:"Select recipients",description:"Choose at least one recipient."});return}try{if(h(!0),t.status==="pending"||t.status==="failed"){(await rt(t.id,r,null)).recipientStored||i({title:"Recipients not saved",description:"Run the email queue migration to store recipient overrides."}),await it(t.id,r);return}const u=await ct(t,r,null);await it(u,r)}catch(u){console.error("Error sending email:",u);const p=u instanceof Error?u.message:"Failed to send this email.";i({title:"Error",description:p,variant:"destructive"})}finally{h(!1)}},ls=async(t,a,r)=>{if(!r){i({title:"Select a time",description:"Choose when to schedule this send."});return}const u=new Date(r);if(Number.isNaN(u.getTime())){i({title:"Invalid time",description:"Please select a valid schedule time."});return}const p=nt(a);if(!p.length){i({title:"Select recipients",description:"Choose at least one recipient."});return}const E=u.toISOString();try{if(h(!0),t.status==="pending"||t.status==="failed"){if(!(await rt(t.id,p,E)).recipientStored){i({title:"Recipients not saved",description:"Run the email queue migration to store recipient overrides.",variant:"destructive"});return}}else await ct(t,p,E);i({title:"Scheduled",description:"Email scheduled successfully."}),await H()}catch(T){console.error("Error scheduling email:",T);const y=T instanceof Error?T.message:"Failed to schedule this email.";i({title:"Error",description:y,variant:"destructive"})}finally{h(!1)}},Me=n.useMemo(()=>S.filter(t=>!t.status||t.status==="active"),[S]),Q=n.useMemo(()=>Me.map(t=>t.email).sort((t,a)=>t.localeCompare(a)),[Me]),ds=n.useMemo(()=>new Set(Q),[Q]),us=n.useMemo(()=>new Map(S.map(t=>[t.email,t.status??"active"])),[S]),ms=n.useCallback((t,a)=>{ge(r=>r[t]?r:{...r,[t]:a})},[]),hs=n.useCallback((t,a)=>{Pe(r=>r[t]?r:{...r,[t]:mt(a)})},[]),ps=n.useCallback((t,a)=>{ge(r=>{const u=new Set(r[t]??Q);return u.has(a)?u.delete(a):u.add(a),{...r,[t]:Array.from(u)}})},[Q]),xs=n.useCallback(t=>{ge(a=>({...a,[t]:Q}))},[Q]),fs=n.useCallback(t=>{ge(a=>({...a,[t]:[]}))},[]),ot=n.useMemo(()=>{const t=R.trim().toLowerCase(),a=W==="all"?S:S.filter(r=>(r.status??"active")===W);return t?a.filter(r=>r.email.toLowerCase().includes(t)):a},[S,W,R]),Ae=S.length,bs=Me.length,vs=S.filter(t=>t.status==="inactive").length,gs=S.filter(t=>t.status==="unsubscribed").length,lt=n.useMemo(()=>new Map(m.map(t=>[t.id,t])),[m]),ws=n.useMemo(()=>[{label:"Queue items",value:m.length},{label:"Blog auto-send",value:X?"On":"Off"},{label:"Project auto-send",value:Z?"On":"Off"},{label:"Subscribers",value:Ae}],[X,m.length,Z,Ae]),dt=n.useMemo(()=>{if(!d)return[];const t=a=>`${a.toFixed(1)}%`;return[{label:"Total Subscribers",value:d.totalSubscribers,icon:e.jsx(vt,{className:"h-4 w-4 text-white/80","aria-hidden":"true"})},{label:"Active Subscribers",value:d.activeSubscribers,icon:e.jsx(vt,{className:"h-4 w-4 text-emerald-300","aria-hidden":"true"})},{label:"Emails Sent",value:d.totalEmailsSent,icon:e.jsx(Os,{className:"h-4 w-4 text-sky-300","aria-hidden":"true"})},{label:"Delivery Rate",value:t(d.deliveryRate),icon:e.jsx(Ds,{className:"h-4 w-4 text-purple-300","aria-hidden":"true"})},{label:"Open Rate",value:t(d.openRate),icon:e.jsx(_e,{className:"h-4 w-4 text-amber-300","aria-hidden":"true"})},{label:"Click Rate",value:t(d.clickRate),icon:e.jsx(Se,{className:"h-4 w-4 text-blue-300","aria-hidden":"true"})}]},[d]),Fe=async t=>{try{C("Email Preview"),k(!0),M("");const a=t.mode==="queue"?t.queueItem.content_type:t.contentType,r=t.mode==="queue"?{contentType:a,contentId:t.queueItem.content_id}:{contentType:a,mode:"latest"},u=t.mode==="queue"?t.queueItem.content_title:void 0,{data:p,error:E}=await I.functions.invoke("render-email-preview",{body:r});if(E||!p?.html){i({title:"Error",description:p?.error||`Unable to load ${a==="blog_post"?"blog post":"project"} preview.`,variant:"destructive"});return}const T=a==="blog_post"?"Blog Post":"Project";p.title?C(`${T} • ${p.title}`):C(u?`${T} • ${u}`:`${T} Preview`),M(p.html)}catch(a){console.error("Error generating preview:",a),i({title:"Error",description:"Failed to generate email preview",variant:"destructive"})}finally{k(!1)}},De=()=>_?e.jsx("div",{className:"flex items-center justify-center py-16 text-white/60",children:"Generating preview…"}):w?e.jsx("div",{className:"border border-white/10 rounded-lg p-4 bg-black",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:w}})}):e.jsx("div",{className:"flex items-center justify-center py-12 text-white/55",children:"Preview will appear here when generated."}),js=async()=>{if(w)try{await navigator.clipboard.writeText(w),i({title:"Copied",description:"Preview HTML copied to clipboard."})}catch(t){console.error("Error copying preview HTML:",t),i({title:"Error",description:"Failed to copy preview HTML.",variant:"destructive"})}},Le=()=>e.jsx("div",{className:"flex justify-end",children:e.jsxs(P,{variant:"soft",size:"sm",onClick:js,disabled:!w,children:[e.jsx(qs,{className:"w-4 h-4 mr-2"}),"Copy HTML"]})}),Ns=t=>{const a={pending:"outline",processing:"info",sent:"success",failed:"danger"},r=t.charAt(0).toUpperCase()+t.slice(1);return e.jsx(ae,{variant:a[t]??"outline",size:"xs",className:"uppercase tracking-wide text-[11px]",children:r})},ut=t=>{const a=t??"active",r=a.charAt(0).toUpperCase()+a.slice(1),p={active:"success",inactive:"warning",unsubscribed:"danger"}[a]??"outline";return e.jsx(ae,{variant:p,size:"xs",className:"uppercase tracking-wide text-[11px]",children:r})},J=t=>{if(!t)return"-";const a=new Date(t);return Number.isNaN(a.getTime())?"-":a.toLocaleString()},mt=t=>{if(!t)return"";const a=new Date(t);if(Number.isNaN(a.getTime()))return"";const r=D=>String(D).padStart(2,"0"),u=a.getFullYear(),p=r(a.getMonth()+1),E=r(a.getDate()),T=r(a.getHours()),y=r(a.getMinutes());return`${u}-${p}-${E}T${T}:${y}`};return c===null||f?e.jsx("div",{className:"min-h-screen bg-black text-white",children:e.jsx(Rs,{className:"min-h-screen",text:"Loading email dashboard...",variant:"orbit"})}):e.jsx("div",{className:"min-h-screen bg-black text-white py-12",children:e.jsxs("div",{className:"container-site space-y-10 pb-24",children:[e.jsx(Is,{eyebrow:"Admin",title:"Email Management",description:"Monitor automations and manage subscribers.",breadcrumbs:[{label:"Admin",href:"/admin"},{label:"Emails",href:"/admin/emails"}],meta:ws,actions:e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(P,{variant:"soft",onClick:H,disabled:f,children:[e.jsx(Ls,{className:`mr-2 h-4 w-4 ${f?"animate-spin":""}`}),"Refresh"]}),e.jsxs(P,{variant:"inverted",onClick:()=>at(),disabled:b,children:[e.jsx(Se,{className:`mr-2 h-4 w-4 ${b?"animate-pulse":""}`}),b?"Processing…":"Process Queue"]})]}),children:!!dt.length&&e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:dt.map(t=>e.jsx(je,{className:"rounded-xl border border-white/10 bg-white/[0.03] shadow-none",children:e.jsx(Ne,{className:"p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-xl bg-white/10",children:t.icon}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-[0.25em] text-white/60",children:t.label}),e.jsx("p",{className:"text-2xl font-bold text-white",children:t.value})]})]})})},t.label))})}),e.jsxs(ia,{defaultValue:"queue",className:"w-full",children:[e.jsxs(Kt,{className:"grid w-full grid-cols-3 rounded-2xl border border-white/10 bg-white/[0.05] p-1",children:[e.jsx(ye,{value:"queue",className:"rounded-xl px-4 py-2 text-sm font-semibold text-white/70 transition data-[state=active]:bg-white data-[state=active]:text-black data-[state=active]:shadow-sm",children:"Email Queue"}),e.jsx(ye,{value:"subscribers",className:"rounded-xl px-4 py-2 text-sm font-semibold text-white/70 transition data-[state=active]:bg-white data-[state=active]:text-black data-[state=active]:shadow-sm",children:"Subscribers"}),e.jsx(ye,{value:"settings",className:"rounded-xl px-4 py-2 text-sm font-semibold text-white/70 transition data-[state=active]:bg-white data-[state=active]:text-black data-[state=active]:shadow-sm",children:"Settings"})]}),e.jsx(Ce,{value:"queue",className:"space-y-4",children:e.jsxs(je,{className:Qe,children:[e.jsxs($e,{className:`${Ge} space-y-1`,children:[e.jsx(Be,{className:He,children:"Email Queue"}),e.jsx(ze,{className:Ke,children:"Manage pending and processed email notifications"})]}),e.jsx(Ne,{className:`${Ve} pt-4`,children:m.length===0?e.jsx("p",{className:"text-white/60 text-center py-8",children:"No email queue items found"}):e.jsx("div",{className:"space-y-4",children:m.map(t=>{const a=ke[t.id]??{sent:0,delivered:0,opened:0,clicked:0,bounced:0,uniqueRecipients:0},r=t.status==="pending"||t.status==="failed",u=t.content_type==="blog_post"?"Blog Post":"Project",p=t.content_title||"Untitled",E=st[t.id]??[],T=new Map(E.map(j=>[j.subscriber_email,j])),y=new Set(S.map(j=>j.email));E.forEach(j=>y.add(j.subscriber_email));const D=Array.from(y).sort((j,A)=>j.localeCompare(A)),ee=t.recipient_emails&&t.recipient_emails.length?t.recipient_emails:Q,B=ts[t.id]??ee,K=B.filter(j=>ds.has(j)),v=new Set(B),L=K.length,ce=ss[t.id]??mt(t.scheduled_at),Oe=r?L:a.uniqueRecipients||a.sent||a.delivered||0;return e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/[0.06] p-6",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"text-base font-semibold text-white",children:p}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(ae,{variant:"outline",size:"xs",className:"text-white/80",children:u}),Ns(t.status),t.retry_count>0&&e.jsxs(ae,{variant:"warning",size:"xs",className:"text-amber-100",children:["Retry ",t.retry_count]})]})]}),e.jsxs("div",{className:"text-sm leading-relaxed text-white/70 space-y-1",children:[e.jsxs("div",{children:["Queued: ",J(t.created_at)]}),t.scheduled_at&&e.jsxs("div",{children:["Scheduled: ",J(t.scheduled_at)]}),t.sent_at&&e.jsxs("div",{children:["Sent: ",J(t.sent_at)]}),t.error_message&&e.jsxs("div",{className:"text-red-400",children:["Error: ",t.error_message]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:justify-end",children:[e.jsxs(ue,{children:[e.jsx(me,{asChild:!0,children:e.jsxs(P,{variant:"soft",size:"sm",className:"data-[state=open]:bg-white/15",onClick:()=>Fe({mode:"queue",queueItem:t}),children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Preview"]})}),e.jsxs(he,{className:"max-w-4xl max-h-[80vh] overflow-y-auto bg-slate-900 text-white border border-white/10",children:[e.jsxs(pe,{children:[e.jsx(xe,{children:F||"Email Preview"}),e.jsx(fe,{className:"text-white/60",children:"Preview of the message generated for this queue item."})]}),Le(),De()]})]}),e.jsxs(ue,{children:[e.jsx(me,{asChild:!0,children:e.jsxs(P,{variant:"soft",size:"sm",onClick:()=>{ms(t.id,ee),hs(t.id,t.scheduled_at)},disabled:b||t.status==="processing",children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Send / Schedule"]})}),e.jsxs(he,{className:"max-w-4xl max-h-[80vh] overflow-y-auto bg-slate-900 text-white border border-white/10",children:[e.jsxs(pe,{children:[e.jsxs(xe,{children:["Send • ",p]}),e.jsx(fe,{className:"text-white/60",children:"Choose recipients and schedule the send."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-end md:justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs uppercase tracking-widest text-white/60",children:"Schedule"}),e.jsx("input",{type:"datetime-local",value:ce,onChange:j=>Pe(A=>({...A,[t.id]:j.target.value})),className:"rounded-md border border-white/10 bg-black/60 px-3 py-2 text-sm text-white/90 focus:outline-none focus:ring-2 focus:ring-white/30"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(P,{variant:"outline",size:"sm",onClick:()=>Pe(j=>({...j,[t.id]:""})),children:"Clear time"}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>xs(t.id),disabled:Q.length===0,children:"Select all"}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>fs(t.id),disabled:L===0,children:"Clear recipients"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(P,{variant:"soft",size:"sm",onClick:()=>os(t,K),disabled:b||L===0,children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Send now"]}),e.jsx(P,{variant:"soft",size:"sm",onClick:()=>ls(t,K,ce),disabled:b||L===0||!ce.length,children:"Schedule send"})]}),e.jsxs("div",{className:"text-xs text-white/60",children:["Selected ",L," / ",Q.length," active recipients"]}),e.jsx("div",{className:"overflow-x-auto rounded-xl border border-white/10 bg-black/40",children:e.jsxs("table",{className:"min-w-full divide-y divide-white/10",children:[e.jsx("thead",{className:"bg-white/5",children:e.jsxs("tr",{className:Ye,children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Recipient"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Last activity"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Include"})]})}),e.jsx("tbody",{className:"divide-y divide-white/10",children:D.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-8 text-center text-white/50",children:"No recipients available yet."})}):D.map(j=>{const A=T.get(j),we=ha(A,t.status),qe=A?_t(A):null,oe=us.get(j)??"inactive",te=oe==="active",se=v.has(j);return e.jsxs("tr",{className:"text-sm text-white/80",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-white",children:j}),oe!=="active"&&e.jsx("span",{className:"text-xs text-white/50",children:oe})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(ae,{variant:we.variant,size:"xs",className:"uppercase tracking-wide text-[11px]",children:we.label})}),e.jsx("td",{className:"px-4 py-3",children:J(qe)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:se,disabled:!te,onChange:()=>ps(t.id,j),className:"h-4 w-4 rounded border-white/20 bg-black/60 text-white focus:ring-2 focus:ring-white/30 disabled:opacity-40","aria-label":`Include ${j}`})})]},j)})})]})})]})]})]}),e.jsxs(P,{variant:"destructive",size:"sm",disabled:b,title:"Remove this queue item",onClick:()=>ns(t.id),children:[e.jsx(Ps,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-6 gap-3 text-xs uppercase tracking-wide text-white/65",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] uppercase tracking-widest text-white/60",children:"Recipients"}),e.jsx("p",{className:"text-base font-semibold text-white",children:Oe})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] uppercase tracking-widest text-white/60",children:"Sent"}),e.jsx("p",{className:"text-base font-semibold text-white",children:a.sent})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] uppercase tracking-widest text-white/60",children:"Delivered"}),e.jsx("p",{className:"text-base font-semibold text-white",children:a.delivered})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] uppercase tracking-widest text-white/60",children:"Opened"}),e.jsx("p",{className:"text-base font-semibold text-white",children:a.opened})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] uppercase tracking-widest text-white/60",children:"Clicked"}),e.jsx("p",{className:"text-base font-semibold text-white",children:a.clicked})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] uppercase tracking-widest text-white/60",children:"Bounced"}),e.jsx("p",{className:"text-base font-semibold text-white",children:a.bounced})]})]})]},t.id)})})})]})}),e.jsx(Ce,{value:"subscribers",className:"space-y-4",children:e.jsxs(je,{className:Qe,children:[e.jsx($e,{className:`${Ge} space-y-1`,children:e.jsxs("div",{className:"flex flex-col gap-2 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx(Be,{className:He,children:"Subscribers"}),e.jsx(ze,{className:Ke,children:"Monitor list health and engagement performance"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs font-medium text-white/60",children:[e.jsxs("span",{children:["Total: ",Ae]}),e.jsxs("span",{children:["Active: ",bs]}),e.jsxs("span",{children:["Inactive: ",vs]}),e.jsxs("span",{children:["Unsubscribed: ",gs]})]})]})}),e.jsxs(Ne,{className:`${Ve} pt-4`,children:[e.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:["all","active","inactive","unsubscribed"].map(t=>{const a=W===t,r=t==="all"?"All":t.charAt(0).toUpperCase()+t.slice(1);return e.jsx(P,{variant:"outline",size:"sm",onClick:()=>ve(t),className:`border-white/20 transition-colors ${a?pa:xa}`,children:r},t)})}),e.jsx("div",{className:"w-full max-w-xs",children:e.jsx(Ms,{value:R,onChange:t=>Te(t.target.value),placeholder:"Search subscribers...",className:"h-9 bg-black/40 border-white/10 text-white/90 placeholder:text-white/40"})})]}),e.jsx("div",{className:"overflow-x-auto rounded-xl border border-white/10 bg-black/40",children:e.jsxs("table",{className:"min-w-full divide-y divide-white/10",children:[e.jsx("thead",{className:"bg-white/5",children:e.jsxs("tr",{className:Ye,children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Subscriber"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Sent"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Delivered"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Opened"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Clicked"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Bounced"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Last Activity"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Subscribed"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-white/10",children:ot.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"px-4 py-8 text-center text-white/50",children:"No subscribers match the selected filter."})}):ot.map(t=>{const a=ie[t.email]??{sent:0,delivered:0,opened:0,clicked:0,bounced:0,lastEvent:void 0},r=t.status??"active",u=U[t.email]??[],p=u[0],E=p?.email_queue_id?lt.get(p.email_queue_id):void 0,T=E?`${E.content_title||"Untitled"} · ${E.content_type==="blog_post"?"Blog":"Project"}`:"-";return e.jsxs("tr",{className:"text-sm text-white/80",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-base font-semibold text-white",children:t.email}),e.jsxs("span",{className:"text-xs text-white/50",children:["Last email: ",T]})]})}),e.jsx("td",{className:"px-4 py-3",children:ut(r)}),e.jsx("td",{className:"px-4 py-3",children:a.sent}),e.jsx("td",{className:"px-4 py-3",children:a.delivered}),e.jsx("td",{className:"px-4 py-3",children:a.opened}),e.jsx("td",{className:"px-4 py-3",children:a.clicked}),e.jsx("td",{className:"px-4 py-3",children:a.bounced}),e.jsx("td",{className:"px-4 py-3",children:J(a.lastEvent)}),e.jsx("td",{className:"px-4 py-3",children:J(t.created_at)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs(ue,{children:[e.jsx(me,{asChild:!0,children:e.jsx(P,{variant:"soft",size:"sm",children:"Manage"})}),e.jsxs(he,{className:"max-w-3xl max-h-[80vh] overflow-y-auto bg-slate-900 text-white border border-white/10",children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"Subscriber"}),e.jsx(fe,{className:"text-white/60",children:"Manage status and review delivery history."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4",children:e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white/60",children:"Email"}),e.jsx("p",{className:"text-base font-semibold text-white",children:t.email})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[ut(r),e.jsxs("select",{value:r,onChange:y=>rs(t.email,y.target.value),className:"rounded-md border border-white/10 bg-black/60 px-2 py-1 text-xs text-white/90 focus:outline-none focus:ring-2 focus:ring-white/30",disabled:re,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"unsubscribed",children:"Unsubscribed"})]}),e.jsx(P,{variant:"destructive",size:"sm",onClick:()=>cs(t.email),disabled:re,children:"Remove"})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold text-white",children:"Email history"}),e.jsx("div",{className:"overflow-x-auto rounded-xl border border-white/10 bg-black/40",children:e.jsxs("table",{className:"min-w-full divide-y divide-white/10",children:[e.jsx("thead",{className:"bg-white/5",children:e.jsxs("tr",{className:Ye,children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Content"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Last activity"})]})}),e.jsx("tbody",{className:"divide-y divide-white/10",children:u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"px-4 py-8 text-center text-white/50",children:"No email history for this subscriber yet."})}):u.map(y=>{const D=Zt(y),ee=_t(y),B=y.email_queue_id?lt.get(y.email_queue_id):void 0,K=B?.content_title?B.content_title:y.email_queue_id?`Queue ${y.email_queue_id.slice(0,6)}`:"Manual",v=B?B.content_type==="blog_post"?"Blog Post":"Project":"Email";return e.jsxs("tr",{className:"text-sm text-white/80",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-white",children:K}),e.jsx("span",{className:"text-xs text-white/50",children:v})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(ae,{variant:D.variant,size:"xs",className:"uppercase tracking-wide text-[11px]",children:D.label})}),e.jsx("td",{className:"px-4 py-3",children:J(ee)})]},`${y.subscriber_email}-${y.id}`)})})]})})]})]})]})]})})]},t.email)})})]})})]})]})}),e.jsx(Ce,{value:"settings",className:"space-y-4",children:e.jsxs(je,{className:Qe,children:[e.jsxs($e,{className:`${Ge} space-y-1`,children:[e.jsx(Be,{className:He,children:"Email Settings"}),e.jsx(ze,{className:Ke,children:"Configure email notification preferences and preview templates"})]}),e.jsx(Ne,{className:`${Ve} pt-4`,children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-white",children:"Auto-send Blog Post Emails"}),e.jsx("p",{className:"text-sm text-white/60 mt-1",children:"Automatically send emails when new blog posts are published"}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx(We,{checked:X,onCheckedChange:as,"aria-label":"Toggle blog auto-send"}),e.jsx("span",{className:"text-xs font-medium text-white/60",children:X?"Enabled":"Disabled"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(ue,{children:[e.jsx(me,{asChild:!0,children:e.jsxs(P,{variant:"soft",size:"sm",onClick:()=>Fe({mode:"latest",contentType:"blog_post"}),disabled:_,className:"data-[state=open]:bg-white/15",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Preview"]})}),e.jsxs(he,{className:"max-w-4xl max-h-[80vh] overflow-y-auto bg-slate-900 text-white border border-white/10",children:[e.jsxs(pe,{children:[e.jsx(xe,{children:F||"Email Preview"}),e.jsx(fe,{className:"text-white/60",children:"Preview of how blog post notification emails will appear to subscribers"})]}),Le(),De()]})]})})]}),e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-white",children:"Auto-send Project Emails"}),e.jsx("p",{className:"text-sm text-white/60 mt-1",children:"Automatically send emails when new projects are published"}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx(We,{checked:Z,onCheckedChange:is,"aria-label":"Toggle project auto-send"}),e.jsx("span",{className:"text-xs font-medium text-white/60",children:Z?"Enabled":"Disabled"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(ue,{children:[e.jsx(me,{asChild:!0,children:e.jsxs(P,{variant:"soft",size:"sm",onClick:()=>Fe({mode:"latest",contentType:"project"}),disabled:_,className:"data-[state=open]:bg-white/15",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Preview"]})}),e.jsxs(he,{className:"max-w-4xl max-h-[80vh] overflow-y-auto bg-slate-900 text-white border border-white/10",children:[e.jsxs(pe,{children:[e.jsx(xe,{children:F||"Email Preview"}),e.jsx(fe,{className:"text-white/60",children:"Preview of how project notification emails will appear to subscribers"})]}),Le(),De()]})]})})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4",children:[e.jsx("h3",{className:"text-base font-semibold text-white",children:"Template source"}),e.jsxs("p",{className:"text-sm text-white/60 mt-1",children:["Edit email templates in ",e.jsx("span",{className:"font-mono",children:"supabase/functions/shared/email-templates.ts"}),". Deploy the ",e.jsx("span",{className:"font-mono",children:"render-email-preview"})," function to see updates here."]})]})]})})]})})]})]})})};export{ya as default};
