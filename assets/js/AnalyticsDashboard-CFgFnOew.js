import{c as S,e as G,a as W,r,s as V,j as e,B as I,F as J}from"./index-B1IGmRtD.js";import{E as K,P as Q}from"./page-header-Bv2ymM8H.js";import{C as l,d as c,a as o,b as d,c as m}from"./card-Cw1i-YhQ.js";import{U as X,T as Y,R as Z}from"./users-CPJGNV5F.js";import{C as ee}from"./clock-CDywXAON.js";const se=S("Chrome",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["line",{x1:"21.17",x2:"12",y1:"8",y2:"8",key:"a0cw5f"}],["line",{x1:"3.95",x2:"8.54",y1:"6.06",y2:"14",key:"1kftof"}],["line",{x1:"10.88",x2:"15.46",y1:"21.94",y2:"14",key:"1ymyh8"}]]);const te=S("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);const ae=S("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);const ie=S("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),x="rounded-xl border border-white/10 bg-white/[0.03]",h="px-6 pt-6 pb-0",p="text-lg font-semibold text-white",u="text-sm text-white/70",g="px-6 pb-6",ne="bg-white text-black border border-white/80 shadow-sm",re="bg-black/40 text-white/75 hover:bg-white/10 hover:text-white",xe=()=>{const k=G(),{toast:f}=W(),[b,C]=r.useState(!0),[n,T]=r.useState([]),[P,y]=r.useState(null),[w,F]=r.useState("7d"),v=r.useCallback(async()=>{C(!0),y(null);const t=new Date,a={"24h":new Date(t.getTime()-1440*60*1e3),"7d":new Date(t.getTime()-10080*60*1e3),"30d":new Date(t.getTime()-720*60*60*1e3)}[w].toISOString(),i=await V.from("page_views").select("*",{count:"exact"}).gte("viewed_at",a).order("viewed_at",{ascending:!1});i.error&&f({title:"Analytics data unavailable",description:i.error.message,variant:"destructive"}),i.data?T(i.data):T([]),typeof i.count=="number"?y(i.count):i.data?y(i.data.length):y(0),C(!1)},[w,f]);r.useEffect(()=>{(async()=>{const{data:{session:s}}=await V.auth.getSession();if(!s){k("/admin/login"),f({title:"Unauthorized",description:"Please log in to access this page.",variant:"destructive"});return}v()})()},[k,f,v]),r.useEffect(()=>{b||v()},[w]);const j=P??n.length,z=new Set(n.map(t=>t.session_id)).size,U=r.useMemo(()=>{const t=n.filter(s=>s.duration);return t.length?t.reduce((s,a)=>s+(a.duration||0),0)/t.length:0},[n]),B=r.useMemo(()=>{const t=n.reduce((i,N)=>(N.session_id&&(i[N.session_id]=(i[N.session_id]||0)+1),i),{}),s=Object.keys(t).length,a=Object.values(t).filter(i=>i===1).length;return s>0?a/s*100:0},[n]),_=r.useMemo(()=>{const t=n.reduce((s,a)=>{const i=a.traffic_source||"unknown";return s[i]=(s[i]||0)+1,s},{});return Object.entries(t).map(([s,a])=>({source:s,count:a})).sort((s,a)=>a.count-s.count)},[n]),L=r.useMemo(()=>{const t=n.reduce((s,a)=>{const i=a.device_type||"unknown";return s[i]=(s[i]||0)+1,s},{});return Object.entries(t).map(([s,a])=>({device:s,count:a})).sort((s,a)=>a.count-s.count)},[n]),$=r.useMemo(()=>{const t=n.reduce((s,a)=>{const i=a.browser||"unknown";return s[i]=(s[i]||0)+1,s},{});return Object.entries(t).map(([s,a])=>({browser:s,count:a})).sort((s,a)=>a.count-s.count)},[n]),D=r.useMemo(()=>{const t=n.reduce((s,a)=>{const i=a.os||"unknown";return s[i]=(s[i]||0)+1,s},{});return Object.entries(t).map(([s,a])=>({os:s,count:a})).sort((s,a)=>a.count-s.count)},[n]),A=r.useMemo(()=>{const t=n.reduce((s,a)=>{const i=a.country||"unknown";return s[i]=(s[i]||0)+1,s},{});return Object.entries(t).map(([s,a])=>({country:s,count:a})).sort((s,a)=>a.count-s.count)},[n]),O=r.useMemo(()=>{const t=n.filter(s=>s.referrer&&s.referrer!=="").reduce((s,a)=>{try{const N=new URL(a.referrer).hostname.replace(/^www\./,"");s[N]=(s[N]||0)+1}catch{s.unknown=(s.unknown||0)+1}return s},{});return Object.entries(t).map(([s,a])=>({referrer:s,count:a})).sort((s,a)=>a.count-s.count).slice(0,10)},[n]),E=r.useMemo(()=>{const t=n.filter(s=>s.utm_campaign).reduce((s,a)=>{const i=a.utm_campaign;return s[i]||(s[i]={views:0,sessions:new Set}),s[i].views++,a.session_id&&s[i].sessions.add(a.session_id),s},{});return Object.entries(t).map(([s,a])=>({campaign:s,views:a.views,visitors:a.sessions.size})).sort((s,a)=>a.views-s.views)},[n]),M=r.useMemo(()=>Object.entries(n.reduce((t,s)=>(t[s.path]||(t[s.path]={views:0,sessions:new Set,durations:[]}),t[s.path].views++,s.session_id&&t[s.path].sessions.add(s.session_id),s.duration&&t[s.path].durations.push(s.duration),t),{})).map(([t,s])=>({path:t,views:s.views,uniqueVisitors:s.sessions.size,avgDuration:s.durations.length?s.durations.reduce((a,i)=>a+i,0)/s.durations.length:0})).sort((t,s)=>s.views-t.views),[n]),R=t=>{const s=Math.floor(t/60),a=Math.floor(t%60);return s>0?`${s}m ${a}s`:`${a}s`},q=[{label:"Total Views",value:j.toLocaleString(),icon:e.jsx(K,{className:"h-5 w-5 text-white/60"})},{label:"Unique Visitors",value:z.toLocaleString(),icon:e.jsx(X,{className:"h-5 w-5 text-white/60"})},{label:"Avg. Duration",value:R(U),icon:e.jsx(ee,{className:"h-5 w-5 text-white/60"})},{label:"Bounce Rate",value:`${B.toFixed(1)}%`,icon:e.jsx(Y,{className:"h-5 w-5 text-white/60"})}],H=[{label:"Time Range",value:w==="24h"?"Last 24 Hours":w==="7d"?"Last 7 Days":"Last 30 Days"},{label:"Page Views",value:j.toLocaleString()}];return e.jsx("div",{className:"min-h-screen bg-black text-white pt-14",children:e.jsxs("div",{className:"container-site space-y-10 pb-24",children:[e.jsx(Q,{eyebrow:"Admin",title:"Analytics Dashboard",description:"Track visitor engagement and traffic performance.",breadcrumbs:[{label:"Admin",href:"/admin"},{label:"Analytics",href:"/admin/analytics"}],meta:H,actions:e.jsxs(I,{variant:"soft",onClick:v,disabled:b,children:[e.jsx(Z,{className:`mr-2 h-4 w-4 ${b?"animate-spin":""}`}),"Refresh"]}),children:e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:q.map(t=>e.jsx(l,{className:"rounded-xl border border-white/10 bg-white/[0.03] shadow-none",children:e.jsx(c,{className:"p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-xl bg-white/10",children:t.icon}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-[0.25em] text-white/60",children:t.label}),e.jsx("p",{className:"text-2xl font-bold text-white",children:t.value})]})]})})},t.label))})}),e.jsx("div",{className:"flex gap-2",children:["24h","7d","30d"].map(t=>e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>F(t),className:`rounded-xl px-4 py-2 text-sm font-semibold transition ${w===t?ne:re}`,children:t==="24h"?"24 Hours":t==="7d"?"7 Days":"30 Days"},t))}),b?e.jsx(J,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(l,{className:x,children:[e.jsxs(o,{className:`${h} space-y-1`,children:[e.jsx(d,{className:p,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Traffic Sources"]})}),e.jsx(m,{className:u,children:"Where your visitors are coming from"})]}),e.jsx(c,{className:`${g} pt-4`,children:_.length===0?e.jsx("p",{className:"text-white/60 text-center py-8",children:"No data available"}):e.jsx("div",{className:"space-y-3",children:_.map(({source:t,count:s})=>{const a=(s/j*100).toFixed(1);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-white/90 capitalize min-w-20",children:t}),e.jsx("div",{className:"flex-1 h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full transition-all",style:{width:`${a}%`}})})]}),e.jsxs("div",{className:"flex items-center gap-3 ml-4",children:[e.jsxs("span",{className:"text-sm text-white/70 min-w-12 text-right",children:[a,"%"]}),e.jsx("span",{className:"text-sm font-semibold text-white min-w-12 text-right",children:s.toLocaleString()})]})]},t)})})})]}),e.jsxs(l,{className:x,children:[e.jsxs(o,{className:`${h} space-y-1`,children:[e.jsx(d,{className:p,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),"Devices"]})}),e.jsx(m,{className:u,children:"Device type breakdown"})]}),e.jsx(c,{className:`${g} pt-4`,children:L.length===0?e.jsx("p",{className:"text-white/60 text-center py-8",children:"No data available"}):e.jsx("div",{className:"space-y-3",children:L.map(({device:t,count:s})=>{const a=(s/j*100).toFixed(1);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-white/90 capitalize min-w-20",children:t}),e.jsx("div",{className:"flex-1 h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full transition-all",style:{width:`${a}%`}})})]}),e.jsxs("div",{className:"flex items-center gap-3 ml-4",children:[e.jsxs("span",{className:"text-sm text-white/70 min-w-12 text-right",children:[a,"%"]}),e.jsx("span",{className:"text-sm font-semibold text-white min-w-12 text-right",children:s.toLocaleString()})]})]},t)})})})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(l,{className:x,children:[e.jsxs(o,{className:`${h} space-y-1`,children:[e.jsx(d,{className:p,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5"}),"Browsers"]})}),e.jsx(m,{className:u,children:"Browser distribution"})]}),e.jsx(c,{className:`${g} pt-4`,children:$.length===0?e.jsx("p",{className:"text-white/60 text-center py-8",children:"No data available"}):e.jsx("div",{className:"space-y-3",children:$.slice(0,5).map(({browser:t,count:s})=>{const a=(s/j*100).toFixed(1);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-white/90 min-w-20",children:t}),e.jsx("div",{className:"flex-1 h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-emerald-500 rounded-full transition-all",style:{width:`${a}%`}})})]}),e.jsxs("div",{className:"flex items-center gap-3 ml-4",children:[e.jsxs("span",{className:"text-sm text-white/70 min-w-12 text-right",children:[a,"%"]}),e.jsx("span",{className:"text-sm font-semibold text-white min-w-12 text-right",children:s.toLocaleString()})]})]},t)})})})]}),e.jsxs(l,{className:x,children:[e.jsxs(o,{className:`${h} space-y-1`,children:[e.jsx(d,{className:p,children:"Operating Systems"}),e.jsx(m,{className:u,children:"OS distribution"})]}),e.jsx(c,{className:`${g} pt-4`,children:D.length===0?e.jsx("p",{className:"text-white/60 text-center py-8",children:"No data available"}):e.jsx("div",{className:"space-y-3",children:D.slice(0,5).map(({os:t,count:s})=>{const a=(s/j*100).toFixed(1);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-white/90 min-w-20",children:t}),e.jsx("div",{className:"flex-1 h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-orange-500 to-red-500 rounded-full transition-all",style:{width:`${a}%`}})})]}),e.jsxs("div",{className:"flex items-center gap-3 ml-4",children:[e.jsxs("span",{className:"text-sm text-white/70 min-w-12 text-right",children:[a,"%"]}),e.jsx("span",{className:"text-sm font-semibold text-white min-w-12 text-right",children:s.toLocaleString()})]})]},t)})})})]})]}),A.filter(t=>t.country!=="unknown").length>0&&e.jsxs(l,{className:x,children:[e.jsxs(o,{className:`${h} space-y-1`,children:[e.jsx(d,{className:p,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5"}),"Geographic Distribution"]})}),e.jsx(m,{className:u,children:"Visitors by country"})]}),e.jsx(c,{className:`${g} pt-4`,children:e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:A.filter(t=>t.country!=="unknown").slice(0,10).map(({country:t,count:s})=>{const a=(s/j*100).toFixed(1);return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-white/5",children:[e.jsx("span",{className:"text-sm font-medium text-white/90",children:t}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm text-white/70",children:[a,"%"]}),e.jsx("span",{className:"text-sm font-semibold text-white min-w-12 text-right",children:s.toLocaleString()})]})]},t)})})})]}),O.length>0&&e.jsxs(l,{className:x,children:[e.jsxs(o,{className:`${h} space-y-1`,children:[e.jsx(d,{className:p,children:"Top Referrers"}),e.jsx(m,{className:u,children:"External sites sending traffic"})]}),e.jsx(c,{className:`${g} pt-4`,children:e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:O.map(({referrer:t,count:s})=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-white/5",children:[e.jsx("span",{className:"text-sm font-mono text-white/90 truncate max-w-[200px]",children:t}),e.jsx("span",{className:"text-sm font-semibold text-white",children:s.toLocaleString()})]},t))})})]}),E.length>0&&e.jsxs(l,{className:x,children:[e.jsxs(o,{className:`${h} space-y-1`,children:[e.jsx(d,{className:p,children:"Campaign Performance"}),e.jsx(m,{className:u,children:"UTM campaign tracking"})]}),e.jsx(c,{className:`${g} pt-4`,children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-xs uppercase tracking-widest text-white/70 border-b border-white/10",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold",children:"Campaign"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:"Views"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:"Visitors"})]})}),e.jsx("tbody",{children:E.map(({campaign:t,views:s,visitors:a})=>e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5 transition",children:[e.jsx("td",{className:"py-3 px-4 text-sm text-white/90",children:t}),e.jsx("td",{className:"py-3 px-4 text-right text-white/90",children:s.toLocaleString()}),e.jsx("td",{className:"py-3 px-4 text-right text-white/90",children:a.toLocaleString()})]},t))})]})})})]}),e.jsxs(l,{className:x,children:[e.jsxs(o,{className:`${h} space-y-1`,children:[e.jsx(d,{className:p,children:"Top Pages"}),e.jsx(m,{className:u,children:"Most visited pages with engagement metrics"})]}),e.jsx(c,{className:`${g} pt-4`,children:M.length===0?e.jsx("p",{className:"text-white/60 text-center py-8",children:"No page views recorded yet"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-xs uppercase tracking-widest text-white/70 border-b border-white/10",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold",children:"Page"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:"Views"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:"Visitors"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:"Avg. Duration"})]})}),e.jsx("tbody",{children:M.map(t=>e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5 transition",children:[e.jsx("td",{className:"py-3 px-4 font-mono text-sm text-white/90",children:t.path}),e.jsx("td",{className:"py-3 px-4 text-right text-white/90",children:t.views.toLocaleString()}),e.jsx("td",{className:"py-3 px-4 text-right text-white/90",children:t.uniqueVisitors.toLocaleString()}),e.jsx("td",{className:"py-3 px-4 text-right text-white/70",children:R(t.avgDuration)})]},t.path))})]})})})]})]})]})})};export{xe as default};
