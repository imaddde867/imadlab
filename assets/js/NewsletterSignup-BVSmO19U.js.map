{"version":3,"mappings":"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","names":["NewsletterSignup","className","email","setEmail","useState","isSubmitting","setIsSubmitting","status","setStatus","validationError","setValidationError","toast","useToast","emailInputRef","useRef","submitButtonRef","statusMessageRef","validateEmail","handleEmailChange","e","newEmail","useEffect","handleSubmit","error","supabase","__vitePreload","logEvent","err","jsx","jsxs","Input","Button"],"ignoreList":[],"sources":["../../../src/components/NewsletterSignup.tsx"],"sourcesContent":["import { useState, type FormEvent, useRef, useEffect } from 'react';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { useToast } from '@/hooks/use-toast';\nimport { supabase } from '@/integrations/supabase/client';\n\ninterface NewsletterSignupProps {\n  className?: string;\n}\n\nconst NewsletterSignup = ({ className = '' }: NewsletterSignupProps) => {\n  const [email, setEmail] = useState('');\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [status, setStatus] = useState<'idle' | 'success' | 'error' | 'already-subscribed'>('idle');\n  const [validationError, setValidationError] = useState<string | null>(null);\n  const { toast } = useToast();\n\n  // Refs for focus management\n  const emailInputRef = useRef<HTMLInputElement>(null);\n  const submitButtonRef = useRef<HTMLButtonElement>(null);\n  const statusMessageRef = useRef<HTMLDivElement>(null);\n\n  // Email validation function\n  const validateEmail = (email: string): boolean => {\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    return emailRegex.test(email);\n  };\n\n  // Handle input change\n  const handleEmailChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const newEmail = e.target.value;\n    setEmail(newEmail);\n\n    // Clear validation error when user starts typing again\n    if (validationError) {\n      setValidationError(null);\n    }\n\n    // Reset status when user changes input\n    if (status !== 'idle') {\n      setStatus('idle');\n    }\n  };\n\n  // Effect for focus management after form submission\n  useEffect(() => {\n    // Move focus to status message when status changes from idle\n    if (status !== 'idle' && statusMessageRef.current) {\n      statusMessageRef.current.focus();\n    }\n  }, [status]);\n\n  // Handle form submission\n  const handleSubmit = async (e: FormEvent) => {\n    e.preventDefault();\n\n    // Validate email\n    if (!email.trim()) {\n      setValidationError('Email is required');\n      // Focus on email input when validation fails\n      emailInputRef.current?.focus();\n      return;\n    }\n\n    if (!validateEmail(email)) {\n      setValidationError('Please enter a valid email address');\n      // Focus on email input when validation fails\n      emailInputRef.current?.focus();\n      return;\n    }\n\n    // Clear validation error\n    setValidationError(null);\n\n    // Set submitting state\n    setIsSubmitting(true);\n\n    try {\n      // Attempt to insert the email into the newsletter_subscribers table\n      const { error } = await supabase\n        .from('newsletter_subscribers')\n        .insert([{ email: email.trim() }]);\n\n      if (error) {\n        // Check if the error is due to a unique constraint violation (already subscribed)\n        if (error.code === '23505') {\n          // PostgreSQL unique constraint violation code\n          setStatus('already-subscribed');\n          toast({\n            title: 'Already subscribed',\n            description: 'This email is already subscribed to the newsletter.',\n            variant: 'default',\n          });\n        } else {\n          // Handle other errors\n          setStatus('error');\n          toast({\n            title: 'Error',\n            description: 'Failed to subscribe. Please try again.',\n            variant: 'destructive',\n          });\n          console.error('Error subscribing:', error);\n        }\n      } else {\n        // Success\n        setStatus('success');\n        toast({\n          title: 'Success!',\n          description: \"Thanks for subscribing! You'll receive updates on new content.\",\n        });\n        // Log event (best-effort)\n        import('@/lib/events').then(({ logEvent }) => logEvent('newsletter_subscribed', { email: email.trim() })).catch(() => {});\n        setEmail(''); // Clear the input field\n      }\n    } catch (err) {\n      // Handle unexpected errors\n      setStatus('error');\n      toast({\n        title: 'Error',\n        description: 'An unexpected error occurred. Please try again.',\n        variant: 'destructive',\n      });\n      console.error('Unexpected error:', err);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <section\n      className={`py-8 sm:py-12 border-t border-white/10 mt-12 sm:mt-16 ${className}`}\n      aria-labelledby=\"newsletter-heading\"\n    >\n      <div className=\"container-site\">\n        <div className=\"flex flex-col lg:flex-row gap-6 sm:gap-8 lg:gap-12 items-start lg:items-center\">\n          {/* Left content - heading and description */}\n          <div className=\"w-full lg:w-2/5 mb-6 lg:mb-0\">\n            <h2 id=\"newsletter-heading\" className=\"text-xl sm:text-2xl font-bold mb-2 sm:mb-3\">\n              Stay Updated\n            </h2>\n            <p className=\"text-white/60 text-sm sm:text-base max-w-md\">\n              Get notified when new projects and blog posts are published. Never miss out on the\n              latest content.\n            </p>\n          </div>\n\n          {/* Right content - form */}\n          <div className=\"w-full lg:w-3/5\">\n            <form\n              onSubmit={handleSubmit}\n              className=\"flex flex-col sm:flex-row gap-3 sm:gap-4\"\n              aria-describedby=\"newsletter-description\"\n              noValidate\n            >\n              <div className=\"flex-1\">\n                <label htmlFor=\"newsletter-email\" className=\"sr-only\">\n                  Email address\n                </label>\n                <Input\n                  id=\"newsletter-email\"\n                  ref={emailInputRef}\n                  type=\"email\"\n                  placeholder=\"Your email address\"\n                  value={email}\n                  onChange={handleEmailChange}\n                  required\n                  aria-required=\"true\"\n                  aria-invalid={!!validationError}\n                  aria-describedby={validationError ? 'email-error' : 'newsletter-description'}\n                  className={`bg-zinc-900/80 border ${validationError ? 'border-red-400' : 'border-white/10'} text-white placeholder:text-white/40 rounded-lg px-4 py-3 focus:ring-2 focus:ring-white/30 focus:border-white/30 transition-all w-full`}\n                  onKeyDown={(e) => {\n                    // Allow submitting form with Enter key\n                    if (e.key === 'Enter') {\n                      e.preventDefault();\n                      handleSubmit(e as unknown as FormEvent);\n                    }\n                  }}\n                />\n                {validationError && (\n                  <p id=\"email-error\" className=\"mt-1 text-red-400 text-xs\" role=\"alert\">\n                    {validationError}\n                  </p>\n                )}\n                <span id=\"newsletter-description\" className=\"sr-only\">\n                  Enter your email to subscribe to our newsletter and receive updates on new\n                  content.\n                </span>\n              </div>\n              <Button\n                ref={submitButtonRef}\n                type=\"submit\"\n                disabled={isSubmitting}\n                className=\"bg-white/10 hover:bg-white/20 text-white font-semibold rounded-lg py-3 transition-colors border border-white/10 shadow whitespace-nowrap h-[42px] sm:h-auto w-full sm:w-auto\"\n                aria-busy={isSubmitting}\n              >\n                {isSubmitting ? 'Subscribing...' : 'Subscribe'}\n              </Button>\n            </form>\n\n            {/* Status messages */}\n            <div\n              className=\"min-h-[24px] mt-2\"\n              ref={statusMessageRef}\n              tabIndex={status !== 'idle' ? -1 : undefined}\n              role={status !== 'idle' ? 'status' : undefined}\n              aria-live=\"polite\"\n            >\n              {status === 'success' && (\n                <p className=\"text-green-400 text-xs sm:text-sm\">\n                  Thanks for subscribing! You'll receive updates on new content.\n                </p>\n              )}\n\n              {status === 'error' && (\n                <p className=\"text-red-400 text-xs sm:text-sm\">\n                  Something went wrong. Please try again.\n                </p>\n              )}\n\n              {status === 'already-subscribed' && (\n                <p className=\"text-yellow-400 text-xs sm:text-sm\">\n                  This email is already subscribed to the newsletter.\n                </p>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n};\n\nexport default NewsletterSignup;\n"],"file":"NewsletterSignup-BVSmO19U.js"}