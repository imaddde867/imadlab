import{c as ie,r as i,a as le,f as ne,e as ce,j as e,B as h,S as o,L as oe,s as u}from"./index-B1IGmRtD.js";import{u as de}from"./useQuery-BA7-oFOl.js";import{u as E,P as A,S as he}from"./useMutation-CViI-cFS.js";import{I as g}from"./input-DGhUk4PP.js";import{T as U}from"./textarea-CZqiqUI7.js";import{C as I,a as z,b as Q,c as B,d as H}from"./card-Cw1i-YhQ.js";import{P as me,E as ue}from"./page-header-Bv2ymM8H.js";import{T as K,a as xe}from"./tag-BD69WoyC.js";import{c as pe,e as ge}from"./content-selects-Bl1-GPQZ.js";import{C as fe}from"./calendar-BbdJ88Zm.js";import{E as O}from"./external-link-Cz28fLjv.js";import{C as je}from"./code-D8i6WOgg.js";const we=ie("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]),$=()=>({title:"",description:"",full_description:"",image_url:"",tech_tags:"",repo_url:"",demo_url:""}),Le=()=>{const[f,w]=i.useState(!1),[x,v]=i.useState(null),[a,n]=i.useState($),[J,Y]=i.useState(!1),[N,_]=i.useState(!1),p=i.useRef(0),{toast:c}=le(),b=ne(),S=ce();i.useEffect(()=>{(async()=>{const{data:{user:s}}=await u.auth.getUser();s||(S("/admin/login"),c({title:"Unauthorized",description:"Please log in to access this page.",variant:"destructive"})),Y(!0)})()},[S,c]);const{data:T,isLoading:V,isFetching:W}=de({queryKey:["projects"],queryFn:async()=>{const{data:t,error:s}=await u.from("projects").select(ge).order("created_at",{ascending:!1});if(s)throw s;return t}}),l=i.useMemo(()=>T??[],[T]),y=l.length,G=y>0,k=i.useMemo(()=>{if(!l.length)return 0;const t=new Date;return l.filter(s=>{const r=new Date(s.created_at);return r.getMonth()===t.getMonth()&&r.getFullYear()===t.getFullYear()}).length},[l]),F=i.useMemo(()=>l.length?l.filter(t=>!!t.repo_url).length:0,[l]),L=i.useMemo(()=>l.length?new Set(l.flatMap(t=>t.tech_tags||[])).size:0,[l]),X=i.useMemo(()=>[{label:"Total projects",value:y},{label:"Repos linked",value:F},{label:"Tech tags",value:L},{label:"This month",value:k}],[k,F,y,L]),D=()=>n($()),j=()=>{p.current+=1,w(!1),v(null),_(!1),D()},M=()=>{w(!0),v(null),D()},Z=()=>{f?j():M()},ee=V||W,C=E({mutationFn:async t=>{const{data:s,error:r}=await u.from("projects").insert([{...t,tech_tags:t.tech_tags?.length?t.tech_tags:null}]).select().single();if(r)throw r;return s},onSuccess:()=>{b.invalidateQueries({queryKey:["projects"]}),j(),c({title:"Project added successfully!"})},onError:t=>{c({title:"Error adding project",description:t.message,variant:"destructive"})}}),P=E({mutationFn:async t=>{const{data:s,error:r}=await u.from("projects").update({title:t.title,description:t.description,full_description:t.full_description,image_url:t.image_url,tech_tags:t.tech_tags,repo_url:t.repo_url,demo_url:t.demo_url}).eq("id",t.id).select().single();if(r)throw r;return s},onSuccess:()=>{b.invalidateQueries({queryKey:["projects"]}),j(),c({title:"Project updated successfully!"})},onError:t=>{c({title:"Error updating project",description:t.message,variant:"destructive"})}}),q=C.isPending||P.isPending,R=q||N,te=E({mutationFn:async t=>{const{error:s}=await u.from("projects").delete().eq("id",t);if(s)throw s},onSuccess:()=>{b.invalidateQueries({queryKey:["projects"]}),c({title:"Project deleted successfully!"})},onError:t=>{c({title:"Error deleting project",description:t.message,variant:"destructive"})}}),se=async t=>{v(t),w(!0),_(!0);const s=p.current+=1;try{const{data:r,error:m}=await u.from("projects").select(pe).eq("id",t.id).maybeSingle();if(m)throw m;const d=r??t;if(s!==p.current)return;n({title:d.title,description:d.description||"",full_description:d.full_description||"",image_url:d.image_url||"",tech_tags:d.tech_tags?.join(", ")||"",repo_url:d.repo_url||"",demo_url:d.demo_url||""})}catch(r){if(console.warn("Failed to load full project content",r),s!==p.current)return;n({title:t.title,description:t.description||"",full_description:t.full_description||"",image_url:t.image_url||"",tech_tags:t.tech_tags?.join(", ")||"",repo_url:t.repo_url||"",demo_url:t.demo_url||""})}finally{s===p.current&&_(!1)}},ae=t=>{confirm("Are you sure you want to delete this project?")&&te.mutate(t)},re=t=>{if(t.preventDefault(),N){c({title:"Still loading",description:"Please wait for the full content to load before saving.",variant:"destructive"});return}if(!a.title.trim())return;const s=a.tech_tags.split(",").map(m=>m.trim()).filter(m=>m.length>0),r={title:a.title,description:a.description||null,full_description:a.full_description||null,image_url:a.image_url||null,tech_tags:s.length>0?s:null,repo_url:a.repo_url||null,demo_url:a.demo_url||null};x?P.mutate({...x,...r}):C.mutate(r)};return J?e.jsx("div",{className:"min-h-screen bg-black text-white py-12",children:e.jsxs("div",{className:"container-site space-y-10 pb-24",children:[e.jsx(me,{eyebrow:"Admin",title:"Projects",description:"Create and manage portfolio projects.",breadcrumbs:[{label:"Admin",href:"/admin"},{label:"Projects",href:"/admin/projects"}],meta:X,actions:e.jsx("div",{className:"flex flex-wrap items-center justify-end gap-2",children:e.jsxs(h,{variant:f?"outline":"inverted",size:"lg",onClick:Z,disabled:q,children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),f?"Cancel":"New Project"]})})}),f&&e.jsxs(I,{className:"rounded-2xl border border-white/10 bg-white/[0.03] shadow-none",children:[e.jsxs(z,{children:[e.jsx(Q,{className:"text-white",children:x?"Edit Project":"Create New Project"}),e.jsx(B,{className:"text-white/70",children:x?"Update your project details":"Add a new project to your portfolio"})]}),e.jsx(H,{children:e.jsxs("form",{onSubmit:re,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white/80",children:"Project Title"}),e.jsx(g,{placeholder:"Enter project title",value:a.title,onChange:t=>n({...a,title:t.target.value}),className:"bg-white/5 border-white/20 text-white placeholder:text-white/50",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white/80",children:"Short Description"}),e.jsx(U,{placeholder:"Brief description that appears on project cards",value:a.description,onChange:t=>n({...a,description:t.target.value}),className:"bg-white/5 border-white/20 text-white placeholder:text-white/50",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white/80",children:"Full Description"}),e.jsx(U,{placeholder:"Detailed description for the project detail page",value:a.full_description,onChange:t=>n({...a,full_description:t.target.value}),className:"bg-white/5 border-white/20 text-white placeholder:text-white/50",rows:6})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white/80",children:"Project Image URL"}),e.jsx(g,{placeholder:"https://example.com/project-image.jpg",value:a.image_url,onChange:t=>n({...a,image_url:t.target.value}),className:"bg-white/5 border-white/20 text-white placeholder:text-white/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white/80",children:"Repository URL"}),e.jsx(g,{placeholder:"https://github.com/username/project",value:a.repo_url,onChange:t=>n({...a,repo_url:t.target.value}),className:"bg-white/5 border-white/20 text-white placeholder:text-white/50"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white/80",children:"Live Demo URL"}),e.jsx(g,{placeholder:"https://your-demo.com",value:a.demo_url,onChange:t=>n({...a,demo_url:t.target.value}),className:"bg-white/5 border-white/20 text-white placeholder:text-white/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white/80",children:"Technologies Used"}),e.jsx(g,{placeholder:"React, TypeScript, Node.js, PostgreSQL",value:a.tech_tags,onChange:t=>n({...a,tech_tags:t.target.value}),className:"bg-white/5 border-white/20 text-white placeholder:text-white/50"})]}),N&&e.jsx("div",{className:"rounded-md border border-white/10 bg-white/[0.02] px-3 py-2 text-xs text-white/60",children:"Loading full contentâ€¦"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(h,{type:"submit",variant:"inverted",disabled:R,children:x?P.isPending?"Updating...":"Update Project":C.isPending?"Creating...":"Create Project"}),e.jsx(h,{type:"button",variant:"ghost",onClick:j,disabled:R,children:"Cancel"})]})]})})]}),e.jsxs(I,{className:"rounded-2xl border border-white/10 bg-white/[0.03] shadow-none",children:[e.jsxs(z,{children:[e.jsx(Q,{className:"text-white",children:"All Projects"}),e.jsx(B,{className:"text-white/70",children:"Manage your portfolio projects"})]}),e.jsx(H,{children:ee?e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((t,s)=>e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/[0.03] p-6",children:[e.jsx(o,{className:"h-6 w-2/3"}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx(o,{className:"h-6 w-24 rounded-full"}),e.jsx(o,{className:"h-6 w-20 rounded-full"}),e.jsx(o,{className:"h-6 w-16 rounded-full"})]}),e.jsx(o,{className:"mt-5 h-4 w-full"}),e.jsx(o,{className:"mt-2 h-4 w-3/5"}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[e.jsx(o,{className:"h-9 w-24 rounded-lg"}),e.jsx(o,{className:"h-9 w-24 rounded-lg"}),e.jsx(o,{className:"h-9 w-24 rounded-lg"})]})]},s))}):G?e.jsx("div",{className:"space-y-4",children:l.map(t=>e.jsx("div",{className:"rounded-2xl border border-white/10 bg-white/[0.02] p-5 transition hover:border-white/20",children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:t.title}),t.tech_tags&&t.tech_tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.tech_tags.slice(0,3).map((s,r)=>e.jsx(K,{size:"xs",variant:"outline",className:"text-white/80",children:s},`${t.id}-tag-${r}`)),t.tech_tags.length>3&&e.jsxs(K,{size:"xs",variant:"subtle",className:"text-white/80",children:["+",t.tech_tags.length-3]})]})]}),e.jsx("p",{className:"text-sm text-white/70 line-clamp-2",children:t.description||"No description available"}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-xs text-white/60",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(fe,{className:"h-3.5 w-3.5 text-white/50","aria-hidden":"true"}),new Date(t.created_at).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(O,{className:"h-3.5 w-3.5 text-white/50","aria-hidden":"true"}),"/projects/",t.id]}),t.repo_url&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(je,{className:"h-3.5 w-3.5 text-white/50","aria-hidden":"true"}),"Repository available"]}),t.demo_url&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(O,{className:"h-3.5 w-3.5 text-white/50","aria-hidden":"true"}),"Demo available"]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(h,{asChild:!0,variant:"soft",size:"sm",children:e.jsxs(oe,{to:`/projects/${t.id}`,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Preview"]})}),e.jsxs(h,{variant:"soft",size:"sm",onClick:()=>se(t),children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(h,{variant:"destructive",size:"sm",onClick:()=>ae(t.id),children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})},t.id))}):e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(we,{className:"mx-auto mb-4 h-12 w-12 text-white/20","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"No projects yet"}),e.jsx("p",{className:"mt-3 text-sm text-white/70",children:"Create your first project to showcase your work."}),e.jsxs(h,{className:"mt-6",variant:"inverted",onClick:M,children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Create First Project"]})]})})]})]})}):e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:e.jsx("div",{className:"text-white/60 text-xl",children:"Checking authentication..."})})};export{Le as default};
