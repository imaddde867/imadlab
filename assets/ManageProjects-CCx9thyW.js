import{r as l,b0 as re,a$ as ie,ar as le,j as e,b7 as k,aH as P,b2 as U,aG as S,b3 as M,b4 as L,aq as ce,L as ne,b1 as oe,b5 as de,b6 as he}from"./vendor-BWaHT4c5.js";import{u as me,B as d,I as b,s as x}from"./index-C2wzmnot.js";import{T as $}from"./textarea-D5PzuC4-.js";import{C as z,a as A,b as R,c as Q,d as B}from"./card-F9rnObCZ.js";import{P as ue,T as K}from"./page-header-B__z29Lg.js";import{S as c}from"./skeleton-3c96cTsB.js";const H=()=>({title:"",description:"",full_description:"",image_url:"",tech_tags:"",repo_url:""}),be=()=>{const[p,N]=l.useState(!1),[m,v]=l.useState(null),[a,n]=l.useState(H),[I,Y]=l.useState(!1),{toast:o}=me(),_=re(),F=ie();l.useEffect(()=>{(async()=>{const{data:{user:s}}=await x.auth.getUser();s||(F("/admin/login"),o({title:"Unauthorized",description:"Please log in to access this page.",variant:"destructive"})),Y(!0)})()},[F,o]);const{data:E,isLoading:G,isFetching:O}=le({queryKey:["projects"],queryFn:async()=>{const{data:t,error:s}=await x.from("projects").select("*").order("created_at",{ascending:!1});if(s)throw s;return t}}),i=l.useMemo(()=>E??[],[E]),u=i.length,W=u>0,g=l.useMemo(()=>{if(!i.length)return 0;const t=new Date;return i.filter(s=>{const r=new Date(s.created_at);return r.getMonth()===t.getMonth()&&r.getFullYear()===t.getFullYear()}).length},[i]),j=l.useMemo(()=>i.length?i.filter(t=>!!t.repo_url).length:0,[i]),w=l.useMemo(()=>i.length?new Set(i.flatMap(t=>t.tech_tags||[])).size:0,[i]),J=l.useMemo(()=>[{label:`${u} active projects`,icon:e.jsx(k,{className:"h-3.5 w-3.5","aria-hidden":"true"}),variant:"neutral"},{label:`${j} with repo access`,icon:e.jsx(P,{className:"h-3.5 w-3.5","aria-hidden":"true"}),variant:"outline"},{label:`${w} tech tags`,icon:e.jsx(U,{className:"h-3.5 w-3.5","aria-hidden":"true"}),variant:"subtle"},{label:`${g} this month`,icon:e.jsx(S,{className:"h-3.5 w-3.5","aria-hidden":"true"}),variant:"subtle"}],[g,j,u,w]),V=l.useMemo(()=>[{label:"Total projects",value:u,icon:e.jsx(k,{className:"h-4 w-4 text-white/80","aria-hidden":"true"})},{label:"Published this month",value:g,icon:e.jsx(S,{className:"h-4 w-4 text-emerald-300","aria-hidden":"true"})},{label:"Repositories linked",value:j,icon:e.jsx(P,{className:"h-4 w-4 text-sky-300","aria-hidden":"true"})},{label:"Unique tech tags",value:w,icon:e.jsx(U,{className:"h-4 w-4 text-amber-300","aria-hidden":"true"})}],[g,j,u,w]),T=()=>n(H()),f=()=>{N(!1),v(null),T()},D=()=>{N(!0),v(null),T()},X=()=>{p?f():D()},Z=G||O,y=M({mutationFn:async t=>{var h;const{data:s,error:r}=await x.from("projects").insert([{...t,tech_tags:(h=t.tech_tags)!=null&&h.length?t.tech_tags:null}]).select().single();if(r)throw r;return s},onSuccess:()=>{_.invalidateQueries({queryKey:["projects"]}),f(),o({title:"Project added successfully!"})},onError:t=>{o({title:"Error adding project",description:t.message,variant:"destructive"})}}),C=M({mutationFn:async t=>{const{data:s,error:r}=await x.from("projects").update({title:t.title,description:t.description,full_description:t.full_description,image_url:t.image_url,tech_tags:t.tech_tags,repo_url:t.repo_url}).eq("id",t.id).select().single();if(r)throw r;return s},onSuccess:()=>{_.invalidateQueries({queryKey:["projects"]}),f(),o({title:"Project updated successfully!"})},onError:t=>{o({title:"Error updating project",description:t.message,variant:"destructive"})}}),q=y.isPending||C.isPending,ee=M({mutationFn:async t=>{const{error:s}=await x.from("projects").delete().eq("id",t);if(s)throw s},onSuccess:()=>{_.invalidateQueries({queryKey:["projects"]}),o({title:"Project deleted successfully!"})},onError:t=>{o({title:"Error deleting project",description:t.message,variant:"destructive"})}}),te=t=>{var s;v(t),n({title:t.title,description:t.description||"",full_description:t.full_description||"",image_url:t.image_url||"",tech_tags:((s=t.tech_tags)==null?void 0:s.join(", "))||"",repo_url:t.repo_url||""}),N(!0)},se=t=>{confirm("Are you sure you want to delete this project?")&&ee.mutate(t)},ae=t=>{if(t.preventDefault(),!a.title.trim())return;const s=a.tech_tags.split(",").map(h=>h.trim()).filter(h=>h.length>0),r={title:a.title,description:a.description||null,full_description:a.full_description||null,image_url:a.image_url||null,tech_tags:s.length>0?s:null,repo_url:a.repo_url||null};m?C.mutate({...m,...r}):y.mutate(r)};return I?e.jsx("div",{className:"min-h-screen bg-black text-white py-12",children:e.jsxs("div",{className:"container-site space-y-10 pb-24",children:[e.jsx(ue,{eyebrow:"Admin Suite",title:"Projects",description:"Maintain and showcase the portfolio work powering imadlab.",breadcrumbs:[{label:"Admin",href:"/admin"},{label:"Projects",href:"/admin/projects"}],meta:J,actions:e.jsxs(d,{variant:p?"outline":"inverted",size:"lg",onClick:X,disabled:q,children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),p?"Cancel":"New Project"]}),children:e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:V.map(t=>e.jsxs("div",{className:"flex items-center gap-4 rounded-2xl border border-white/10 bg-white/5 px-5 py-4 shadow-[0_16px_48px_rgba(15,23,42,0.45)] backdrop-blur-sm",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-xl bg-white/10",children:t.icon}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-[0.25em] text-white/60",children:t.label}),e.jsx("p",{className:"text-2xl font-bold text-white",children:t.value})]})]},t.label))})}),p&&e.jsxs(z,{className:"rounded-3xl border border-white/10 bg-white/5 shadow-[0_20px_60px_rgba(15,23,42,0.45)] backdrop-blur-md",children:[e.jsxs(A,{children:[e.jsx(R,{className:"text-white",children:m?"Edit Project":"Create New Project"}),e.jsx(Q,{className:"text-white/70",children:m?"Update your project details":"Add a new project to your portfolio"})]}),e.jsx(B,{children:e.jsxs("form",{onSubmit:ae,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white/80",children:"Project Title"}),e.jsx(b,{placeholder:"Enter project title",value:a.title,onChange:t=>n({...a,title:t.target.value}),className:"bg-white/5 border-white/20 text-white placeholder:text-white/50",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white/80",children:"Short Description"}),e.jsx($,{placeholder:"Brief description that appears on project cards",value:a.description,onChange:t=>n({...a,description:t.target.value}),className:"bg-white/5 border-white/20 text-white placeholder:text-white/50",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white/80",children:"Full Description"}),e.jsx($,{placeholder:"Detailed description for the project detail page",value:a.full_description,onChange:t=>n({...a,full_description:t.target.value}),className:"bg-white/5 border-white/20 text-white placeholder:text-white/50",rows:6})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white/80",children:"Project Image URL"}),e.jsx(b,{placeholder:"https://example.com/project-image.jpg",value:a.image_url,onChange:t=>n({...a,image_url:t.target.value}),className:"bg-white/5 border-white/20 text-white placeholder:text-white/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white/80",children:"Repository URL"}),e.jsx(b,{placeholder:"https://github.com/username/project",value:a.repo_url,onChange:t=>n({...a,repo_url:t.target.value}),className:"bg-white/5 border-white/20 text-white placeholder:text-white/50"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white/80",children:"Technologies Used"}),e.jsx(b,{placeholder:"React, TypeScript, Node.js, PostgreSQL",value:a.tech_tags,onChange:t=>n({...a,tech_tags:t.target.value}),className:"bg-white/5 border-white/20 text-white placeholder:text-white/50"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(d,{type:"submit",variant:"inverted",disabled:q,children:m?C.isPending?"Updating...":"Update Project":y.isPending?"Creating...":"Create Project"}),e.jsx(d,{type:"button",variant:"ghost",onClick:f,children:"Cancel"})]})]})})]}),e.jsxs(z,{className:"rounded-3xl border border-white/10 bg-white/5 shadow-[0_20px_60px_rgba(15,23,42,0.45)] backdrop-blur-md",children:[e.jsxs(A,{children:[e.jsx(R,{className:"text-white",children:"All Projects"}),e.jsx(Q,{className:"text-white/70",children:"Manage your portfolio projects and showcase your work"})]}),e.jsx(B,{children:Z?e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((t,s)=>e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-6 backdrop-blur-sm",children:[e.jsx(c,{className:"h-6 w-2/3"}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx(c,{className:"h-6 w-24 rounded-full"}),e.jsx(c,{className:"h-6 w-20 rounded-full"}),e.jsx(c,{className:"h-6 w-16 rounded-full"})]}),e.jsx(c,{className:"mt-5 h-4 w-full"}),e.jsx(c,{className:"mt-2 h-4 w-3/5"}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[e.jsx(c,{className:"h-9 w-24 rounded-lg"}),e.jsx(c,{className:"h-9 w-24 rounded-lg"}),e.jsx(c,{className:"h-9 w-24 rounded-lg"})]})]},s))}):W?e.jsx("div",{className:"space-y-4",children:i.map(t=>e.jsx("div",{className:"rounded-2xl border border-white/10 bg-black/60 p-6 shadow-[0_16px_48px_rgba(15,23,42,0.45)] backdrop-blur-sm transition hover:border-white/20",children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:t.title}),t.tech_tags&&t.tech_tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.tech_tags.slice(0,3).map((s,r)=>e.jsx(K,{size:"xs",variant:"outline",className:"text-white/80",children:s},`${t.id}-tag-${r}`)),t.tech_tags.length>3&&e.jsxs(K,{size:"xs",variant:"subtle",className:"text-white/80",children:["+",t.tech_tags.length-3]})]})]}),e.jsx("p",{className:"text-sm text-white/70 line-clamp-2",children:t.description||"No description available"}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-xs text-white/60",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(S,{className:"h-3.5 w-3.5 text-white/50","aria-hidden":"true"}),new Date(t.created_at).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ce,{className:"h-3.5 w-3.5 text-white/50","aria-hidden":"true"}),"/projects/",t.id]}),t.repo_url&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(P,{className:"h-3.5 w-3.5 text-white/50","aria-hidden":"true"}),"Repository available"]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(d,{asChild:!0,variant:"soft",size:"sm",children:e.jsxs(ne,{to:`/projects/${t.id}`,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),"Preview"]})}),e.jsxs(d,{variant:"soft",size:"sm",onClick:()=>te(t),children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(d,{variant:"destructive",size:"sm",onClick:()=>se(t.id),children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})},t.id))}):e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(k,{className:"mx-auto mb-4 h-12 w-12 text-white/20","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"No projects yet"}),e.jsx("p",{className:"mt-3 text-sm text-white/70",children:"Create your first project to showcase your work."}),e.jsxs(d,{className:"mt-6",variant:"inverted",onClick:D,children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"Create First Project"]})]})})]})]})}):e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:e.jsx("div",{className:"text-white/60 text-xl",children:"Checking authentication..."})})};export{be as default};
