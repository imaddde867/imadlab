import{r as i,b0 as ie,a$ as ne,ar as ce,j as e,b1 as f,aG as P,b2 as L,aF as M,b3 as S,b4 as z,aq as de,L as oe,b5 as he,b6 as me}from"./vendor-BWaHT4c5.js";import{u as ue,B as m,I as N,s as u}from"./index-C2wzmnot.js";import{T as A}from"./textarea-D5PzuC4-.js";import{C as U,a as Q,b as B,c as I,d as K}from"./card-F9rnObCZ.js";import{P as xe,T as R}from"./page-header-B__z29Lg.js";import{S as n}from"./skeleton-3c96cTsB.js";const H=()=>({title:"",slug:"",body:"",excerpt:"",tags:"",image_url:""}),Ne=()=>{const[x,v]=i.useState(!1),[c,y]=i.useState(null),[a,d]=i.useState(H),[Y,G]=i.useState(!1),{toast:o}=ue(),C=ie(),E=ne();i.useEffect(()=>{(async()=>{const{data:{user:s}}=await u.auth.getUser();s||(E("/admin/login"),o({title:"Unauthorized",description:"Please log in to access this page.",variant:"destructive"})),G(!0)})()},[E,o]);const{data:F,isLoading:T}=ce({queryKey:["posts"],queryFn:async()=>{const{data:t,error:s}=await u.from("posts").select("*").order("published_date",{ascending:!1});if(s)throw s;return t.map(r=>({...r,read_time:r.read_time??0,image_url:r.image_url??null}))}}),l=i.useMemo(()=>F??[],[F]),g=l.length,p=i.useMemo(()=>{if(!l.length)return 0;const t=new Date;return l.filter(s=>{const r=new Date(s.created_at);return r.getMonth()===t.getMonth()&&r.getFullYear()===t.getFullYear()}).length},[l]),w=i.useMemo(()=>{if(!l.length)return 0;const t=l.reduce((s,r)=>s+(r.read_time||0),0);return Math.round(t/l.length)},[l]),b=i.useMemo(()=>l.length?new Set(l.flatMap(t=>t.tags||[])).size:0,[l]),O=i.useMemo(()=>[{label:`${g} total posts`,icon:e.jsx(f,{className:"h-3.5 w-3.5","aria-hidden":"true"}),variant:"neutral"},{label:`${p} this month`,icon:e.jsx(P,{className:"h-3.5 w-3.5","aria-hidden":"true"}),variant:"subtle"},{label:`${b} unique tags`,icon:e.jsx(L,{className:"h-3.5 w-3.5","aria-hidden":"true"}),variant:"outline"},{label:`${w||0} min avg read`,icon:e.jsx(M,{className:"h-3.5 w-3.5","aria-hidden":"true"}),variant:"subtle"}],[w,p,g,b]),W=i.useMemo(()=>[{label:"Total posts",value:g,icon:e.jsx(f,{className:"h-4 w-4 text-white/80","aria-hidden":"true"})},{label:"Published this month",value:p,icon:e.jsx(P,{className:"h-4 w-4 text-emerald-300","aria-hidden":"true"})},{label:"Average read time",value:`${w||0}m`,icon:e.jsx(M,{className:"h-4 w-4 text-sky-300","aria-hidden":"true"})},{label:"Unique tags",value:b,icon:e.jsx(L,{className:"h-4 w-4 text-amber-300","aria-hidden":"true"})}],[w,p,g,b]),J=T,_=S({mutationFn:async t=>{var h;const{data:s,error:r}=await u.from("posts").insert([{...t,tags:(h=t.tags)!=null&&h.length?t.tags:null}]).select().single();if(r)throw r;return s},onSuccess:()=>{C.invalidateQueries({queryKey:["posts"]}),j(),o({title:"Post added successfully!"})},onError:t=>{o({title:"Error adding post",description:t.message,variant:"destructive"})}}),k=S({mutationFn:async t=>{const{data:s,error:r}=await u.from("posts").update({title:t.title,slug:t.slug,body:t.body,excerpt:t.excerpt,tags:t.tags,published_date:t.published_date,read_time:t.read_time,image_url:t.image_url}).eq("id",t.id).select().single();if(r)throw r;return s},onSuccess:()=>{C.invalidateQueries({queryKey:["posts"]}),j(),o({title:"Post updated successfully!"})},onError:t=>{o({title:"Error updating post",description:t.message,variant:"destructive"})}}),q=_.isPending||k.isPending,V=S({mutationFn:async t=>{const{error:s}=await u.from("posts").delete().eq("id",t);if(s)throw s},onSuccess:()=>{C.invalidateQueries({queryKey:["posts"]}),o({title:"Post deleted successfully!"})},onError:t=>{o({title:"Error deleting post",description:t.message,variant:"destructive"})}}),X=t=>t.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),Z=t=>{if(!t)return 0;const s=200,r=t.split(/\s+/).filter(h=>h.length>0).length;return Math.ceil(r/s)},D=()=>d(H()),j=()=>{v(!1),y(null),D()},$=()=>{v(!0),y(null),D()},ee=()=>{x?j():$()},te=t=>{d({...a,title:t,slug:X(t)})},se=t=>{var s;y(t),d({title:t.title,slug:t.slug,body:t.body||"",excerpt:t.excerpt||"",tags:((s=t.tags)==null?void 0:s.join(", "))||"",image_url:t.image_url||""}),v(!0)},ae=t=>{confirm("Are you sure you want to delete this post?")&&V.mutate(t)},re=t=>{if(t.preventDefault(),!a.title.trim()||!a.slug.trim())return;const s=a.tags.split(",").map(h=>h.trim()).filter(h=>h.length>0),r={title:a.title,slug:a.slug,body:a.body||null,excerpt:a.excerpt||null,tags:s.length>0?s:null,published_date:(c==null?void 0:c.published_date)||new Date().toISOString(),read_time:Z(a.body),image_url:a.image_url||null};c?k.mutate({...c,...r}):_.mutate(r)};if(!Y)return e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:e.jsx("div",{className:"text-white/60 text-xl",children:"Checking authentication..."})});if(T)return e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:e.jsx("div",{className:"text-white/60",children:"Loading posts..."})});const le=l.length>0;return e.jsx("div",{className:"min-h-screen bg-black text-white py-12",children:e.jsxs("div",{className:"container-site space-y-10 pb-24",children:[e.jsx(xe,{eyebrow:"Admin Suite",title:"Blog Posts",description:"Craft, edit, and publish articles across imadlab while keeping tabs on performance.",breadcrumbs:[{label:"Admin",href:"/admin"},{label:"Posts",href:"/admin/posts"}],meta:O,actions:e.jsxs(m,{variant:x?"outline":"inverted",size:"lg",onClick:ee,disabled:q,children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),x?"Cancel":"New Post"]}),children:e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:W.map(t=>e.jsxs("div",{className:"flex items-center gap-4 rounded-2xl border border-white/10 bg-white/5 px-5 py-4 shadow-[0_16px_48px_rgba(15,23,42,0.45)] backdrop-blur-sm",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-xl bg-white/10",children:t.icon}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-[0.25em] text-white/60",children:t.label}),e.jsx("p",{className:"text-2xl font-bold text-white",children:t.value})]})]},t.label))})}),x&&e.jsxs(U,{className:"rounded-3xl border border-white/10 bg-white/5 shadow-[0_20px_60px_rgba(15,23,42,0.45)] backdrop-blur-md",children:[e.jsxs(Q,{children:[e.jsx(B,{className:"text-white",children:c?"Edit Post":"Create New Post"}),e.jsx(I,{className:"text-white/70",children:c?"Update your blog post details":"Add a new blog post to your collection"})]}),e.jsx(K,{children:e.jsxs("form",{onSubmit:re,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white/80",children:"Title"}),e.jsx(N,{placeholder:"Enter post title",value:a.title,onChange:t=>te(t.target.value),className:"bg-white/5 border-white/20 text-white placeholder:text-white/50",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white/80",children:"Slug"}),e.jsx(N,{placeholder:"url-friendly-slug",value:a.slug,onChange:t=>d({...a,slug:t.target.value}),className:"bg-white/5 border-white/20 text-white placeholder:text-white/50",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white/80",children:"Excerpt"}),e.jsx(A,{placeholder:"Brief summary of your post",value:a.excerpt,onChange:t=>d({...a,excerpt:t.target.value}),className:"bg-white/5 border-white/20 text-white placeholder:text-white/50",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white/80",children:"Content"}),e.jsx(A,{placeholder:"Write your post content here...",value:a.body,onChange:t=>d({...a,body:t.target.value}),className:"bg-white/5 border-white/20 text-white placeholder:text-white/50",rows:12})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white/80",children:"Featured Image URL"}),e.jsx(N,{placeholder:"https://example.com/image.jpg",value:a.image_url,onChange:t=>d({...a,image_url:t.target.value}),className:"bg-white/5 border-white/20 text-white placeholder:text-white/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white/80",children:"Tags"}),e.jsx(N,{placeholder:"react, typescript, web development",value:a.tags,onChange:t=>d({...a,tags:t.target.value}),className:"bg-white/5 border-white/20 text-white placeholder:text-white/50"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(m,{type:"submit",variant:"inverted",disabled:q,children:c?k.isPending?"Updating...":"Update Post":_.isPending?"Creating...":"Create Post"}),e.jsx(m,{type:"button",variant:"ghost",onClick:j,children:"Cancel"})]})]})})]}),e.jsxs(U,{className:"rounded-3xl border border-white/10 bg-white/5 shadow-[0_20px_60px_rgba(15,23,42,0.45)] backdrop-blur-md",children:[e.jsxs(Q,{children:[e.jsx(B,{className:"text-white",children:"All Posts"}),e.jsx(I,{className:"text-white/70",children:"Manage your blog posts and track their performance"})]}),e.jsx(K,{children:J?e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((t,s)=>e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-6 backdrop-blur-sm",children:[e.jsx(n,{className:"h-6 w-2/3"}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx(n,{className:"h-6 w-24 rounded-full"}),e.jsx(n,{className:"h-6 w-20 rounded-full"}),e.jsx(n,{className:"h-6 w-16 rounded-full"})]}),e.jsx(n,{className:"mt-5 h-4 w-full"}),e.jsx(n,{className:"mt-2 h-4 w-3/5"}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[e.jsx(n,{className:"h-9 w-24 rounded-lg"}),e.jsx(n,{className:"h-9 w-24 rounded-lg"}),e.jsx(n,{className:"h-9 w-24 rounded-lg"})]})]},s))}):le?e.jsx("div",{className:"space-y-4",children:l.map(t=>e.jsx("div",{className:"rounded-2xl border border-white/10 bg-black/60 p-6 shadow-[0_16px_48px_rgba(15,23,42,0.45)] backdrop-blur-sm transition hover:border-white/20",children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:t.title}),t.tags&&t.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.tags.slice(0,3).map((s,r)=>e.jsx(R,{size:"xs",variant:"outline",className:"text-white/80",children:s},`${t.id}-tag-${r}`)),t.tags.length>3&&e.jsxs(R,{size:"xs",variant:"subtle",className:"text-white/80",children:["+",t.tags.length-3]})]})]}),e.jsx("p",{className:"text-sm text-white/70 line-clamp-2",children:t.excerpt||"No excerpt available"}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-xs text-white/60",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(P,{className:"h-3.5 w-3.5 text-white/50","aria-hidden":"true"}),new Date(t.published_date).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(M,{className:"h-3.5 w-3.5 text-white/50","aria-hidden":"true"}),t.read_time||0," min read"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(de,{className:"h-3.5 w-3.5 text-white/50","aria-hidden":"true"}),"/",t.slug]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(m,{asChild:!0,variant:"soft",size:"sm",children:e.jsxs(oe,{to:`/blogs/${t.slug}`,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(f,{className:"mr-2 h-4 w-4"}),"Preview"]})}),e.jsxs(m,{variant:"soft",size:"sm",onClick:()=>se(t),children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(m,{variant:"destructive",size:"sm",onClick:()=>ae(t.id),children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})},t.id))}):e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(f,{className:"mx-auto mb-4 h-12 w-12 text-white/20","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"No posts yet"}),e.jsx("p",{className:"mt-3 text-sm text-white/70",children:"Create your first blog post to get started."}),e.jsxs(m,{className:"mt-6",variant:"inverted",onClick:$,children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Create First Post"]})]})})]})]})})};export{Ne as default};
